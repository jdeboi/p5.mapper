!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["p5.mapper"]=e():t["p5.mapper"]=e()}(this,()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}t.d(e,{default:()=>ie});var r={dim:function(t){var e;return"object"===n(t)?"object"===n(e=t[0])?"object"===n(e[0])?r._dim(t):[t.length,e.length]:[t.length]:[]},_foreach2:function t(e,n,r,i){if(r===n.length-1)return i(e);var o,s=n[r],a=Array(s);for(o=s-1;o>=0;o--)a[o]=t(e[o],n,r+1,i);return a},cloneV:function(t){var e,n=t.length,r=Array(n);for(e=n-1;-1!==e;--e)r[e]=t[e];return r},clone:function(t){if("object"!==n(t))return t;var e=r.cloneV,i=r.dim(t);return r._foreach2(t,i,0,e)},diag:function(t){var e,n,r,i,o=t.length,s=Array(o);for(e=o-1;e>=0;e--){for(i=Array(o),n=e+2,r=o-1;r>=n;r-=2)i[r]=0,i[r-1]=0;for(r>e&&(i[r]=0),i[e]=t[e],r=e-1;r>=1;r-=2)i[r]=0,i[r-1]=0;0===r&&(i[0]=0),s[e]=i}return s},rep:function(t,e,n){void 0===n&&(n=0);var i,o=t[n],s=Array(o);if(n===t.length-1){for(i=o-2;i>=0;i-=2)s[i+1]=e,s[i]=e;return-1===i&&(s[0]=e),s}for(i=o-1;i>=0;i--)s[i]=r.rep(t,e,n+1);return s},identity:function(t){return r.diag(r.rep([t],1))},inv:function(t){var e,n,i,o,s,a,u,l,h=r.dim(t),c=Math.abs,f=h[0],p=h[1],y=r.clone(t),v=r.identity(f);for(a=0;a<p;++a){var d=-1,b=-1;for(s=a;s!==f;++s)(u=c(y[s][a]))>b&&(d=s,b=u);for(n=y[d],y[d]=y[a],y[a]=n,o=v[d],v[d]=v[a],v[a]=o,l=n[a],u=a;u!==p;++u)n[u]/=l;for(u=p-1;-1!==u;--u)o[u]/=l;for(s=f-1;-1!==s;--s)if(s!==a){for(e=y[s],i=v[s],l=e[a],u=a+1;u!==p;++u)e[u]-=n[u]*l;for(u=p-1;u>0;--u)i[u]-=o[u]*l,i[--u]-=o[u]*l;0===u&&(i[0]-=o[0]*l)}}return v},dotMMsmall:function(t,e){var n,r,i,o,s,a,u,l,h,c,f;for(o=t.length,s=e.length,a=e[0].length,u=Array(o),n=o-1;n>=0;n--){for(l=Array(a),h=t[n],i=a-1;i>=0;i--){for(c=h[s-1]*e[s-1][i],r=s-2;r>=1;r-=2)f=r-1,c+=h[r]*e[r][i]+h[f]*e[f][i];0===r&&(c+=h[0]*e[0][i]),l[i]=c}u[n]=l}return u},dotMV:function(t,e){var n,i=t.length,o=Array(i),s=r.dotVV;for(n=i-1;n>=0;n--)o[n]=s(t[n],e);return o},dotVV:function(t,e){var n,r,i=t.length,o=t[i-1]*e[i-1];for(n=i-2;n>=1;n-=2)r=n-1,o+=t[n]*e[n]+t[r]*e[r];return 0===n&&(o+=t[0]*e[0]),o},transpose:function(t){var e,n,r,i,o,s=t.length,a=t[0].length,u=Array(a);for(n=0;n<a;n++)u[n]=Array(s);for(e=s-1;e>=1;e-=2){for(i=t[e],r=t[e-1],n=a-1;n>=1;--n)(o=u[n])[e]=i[n],o[e-1]=r[n],(o=u[--n])[e]=i[n],o[e-1]=r[n];0===n&&((o=u[0])[e]=i[0],o[e-1]=r[0])}if(0===e){for(r=t[0],n=a-1;n>=1;--n)u[n][0]=r[n],u[--n][0]=r[n];0===n&&(u[0][0]=r[0])}return u}};const i=r;function o(t){return Math.round(1e10*t)/1e10}function s(t,e,n){if(n){var r=e;e=t,t=r}var s,a=[[t[0],t[1],1,0,0,0,-1*e[0]*t[0],-1*e[0]*t[1]],[0,0,0,t[0],t[1],1,-1*e[1]*t[0],-1*e[1]*t[1]],[t[2],t[3],1,0,0,0,-1*e[2]*t[2],-1*e[2]*t[3]],[0,0,0,t[2],t[3],1,-1*e[3]*t[2],-1*e[3]*t[3]],[t[4],t[5],1,0,0,0,-1*e[4]*t[4],-1*e[4]*t[5]],[0,0,0,t[4],t[5],1,-1*e[5]*t[4],-1*e[5]*t[5]],[t[6],t[7],1,0,0,0,-1*e[6]*t[6],-1*e[6]*t[7]],[0,0,0,t[6],t[7],1,-1*e[7]*t[6],-1*e[7]*t[7]]],u=e;try{s=i.inv(i.dotMMsmall(i.transpose(a),a))}catch(t){return console.log(t),[1,0,0,0,1,0,0,0]}for(var l=i.dotMMsmall(s,i.transpose(a)),h=i.dotMV(l,u),c=0;c<h.length;c++)h[c]=o(h[c]);return h[8]=1,h}function a(t,e){return"undefined"!=typeof window&&window===this||void 0===this?new a(t,e):(this.srcPts=t,this.dstPts=e,this.coeffs=s(this.srcPts,this.dstPts,!1),this.coeffsInv=s(this.srcPts,this.dstPts,!0),this)}a.prototype={transform:function(t,e){var n=[];return n[0]=(this.coeffs[0]*t+this.coeffs[1]*e+this.coeffs[2])/(this.coeffs[6]*t+this.coeffs[7]*e+1),n[1]=(this.coeffs[3]*t+this.coeffs[4]*e+this.coeffs[5])/(this.coeffs[6]*t+this.coeffs[7]*e+1),n},transformInverse:function(t,e){var n=[];return n[0]=(this.coeffsInv[0]*t+this.coeffsInv[1]*e+this.coeffsInv[2])/(this.coeffsInv[6]*t+this.coeffsInv[7]*e+1),n[1]=(this.coeffsInv[3]*t+this.coeffsInv[4]*e+this.coeffsInv[5])/(this.coeffsInv[6]*t+this.coeffsInv[7]*e+1),n}};const u=a;function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,p(r.key),r)}}function f(t,e,n){return(e=p(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t){var e=function(t){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==l(e)?e:e+""}var y=function(){return t=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,"x",0),f(this,"y",0),f(this,"clickX",0),f(this,"clickY",0),f(this,"xStartDrag",0),f(this,"yStartDrag",0),f(this,"_dragging",!1),f(this,"_enabled",!0),f(this,"_bounds",null),f(this,"_grid",null),f(this,"_axis","none"),this.pInst=e,this.x=n,this.y=r,this.xStartDrag=n,this.yStartDrag=r},e=[{key:"setEnabled",value:function(t){return this._enabled=!!t,!this._enabled&&this._dragging&&this.endDrag(),this}},{key:"enabled",get:function(){return this._enabled}},{key:"setLockAxis",value:function(t){return this._axis=t,this}},{key:"setBounds",value:function(t){return this._bounds=t,this.applyBounds(),this}},{key:"setGrid",value:function(t){return this._grid=null==t?null:Array.isArray(t)?[Math.max(1,t[0]),Math.max(1,t[1])]:[Math.max(1,t),Math.max(1,t)],this}},{key:"startDrag",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pInst.mouseX,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pInst.mouseY;this._enabled&&(this._dragging=!0,this.xStartDrag=this.x,this.yStartDrag=this.y,this.clickX=e,this.clickY=n,null===(t=this.onDragStart)||void 0===t||t.call(this,{x:this.x,y:this.y}))}},{key:"moveTo",value:function(t,e){var n;if("number"==typeof t&&"number"==typeof e){var r,i=this.applyConstraints(t,e);return this.x=i.x,this.y=i.y,void(this._dragging&&(null===(r=this.onDragMove)||void 0===r||r.call(this,{x:this.x,y:this.y})))}var o=this.pInst.mouseX,s=this.pInst.mouseY,a=this.xStartDrag+(o-this.clickX),u=this.yStartDrag+(s-this.clickY),l=this.applyConstraints(a,u);this.x=l.x,this.y=l.y,this._dragging&&(null===(n=this.onDragMove)||void 0===n||n.call(this,{x:this.x,y:this.y}))}},{key:"translate",value:function(t,e){this.moveTo(this.x+t,this.y+e)}},{key:"getIsDragging",value:function(){return this._dragging}},{key:"getIsEnabled",value:function(){return this._enabled}},{key:"updateDrag",value:function(t,e){var n;if(this._dragging){var r=this.xStartDrag+(t-this.clickX),i=this.yStartDrag+(e-this.clickY),o=this.applyConstraints(r,i);this.x=o.x,this.y=o.y,null===(n=this.onDragMove)||void 0===n||n.call(this,{x:this.x,y:this.y})}}},{key:"endDrag",value:function(){var t;this._dragging&&(this._dragging=!1,null===(t=this.onDragEnd)||void 0===t||t.call(this,{x:this.x,y:this.y}))}},{key:"selectDraggable",value:function(){return this.isMouseOver()?(this.startDrag(),this):null}},{key:"selectPoints",value:function(){throw new Error("selectPoints() must be implemented by subclass")}},{key:"isDragging",get:function(){return this._dragging}},{key:"set",value:function(t){var e="number"==typeof t.x?t.x:this.x,n="number"==typeof t.y?t.y:this.y,r=this.applyConstraints(e,n);return this.x=r.x,this.y=r.y,this}},{key:"getMouseCoords",value:function(){return{x:this.pInst.mouseX-this.pInst.width/2,y:this.pInst.mouseY-this.pInst.height/2}}},{key:"isMouseOver",value:function(){return console.error("isMouseOver() must be implemented by subclass"),!1}},{key:"applyConstraints",value:function(t,e){if("x"===this._axis?e=this.y:"y"===this._axis&&(t=this.x),this._bounds){var n=this._bounds,r=n.x,i=n.y,o=n.w,s=n.h;t=v(t,r,r+o),e=v(e,i,i+s)}if(this._grid){var a=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,s,a=[],u=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this._grid,2),u=a[0],l=a[1];t=Math.round(t/u)*u,e=Math.round(e/l)*l}return{x:t,y:e}}},{key:"applyBounds",value:function(){if(this._bounds){var t=this.applyConstraints(this.x,this.y);this.x=t.x,this.y=t.y}}},{key:"toJSON",value:function(){return{x:this.x,y:this.y,dragging:this.getIsDragging(),enabled:this.getIsEnabled()}}},{key:"load",value:function(t){throw new Error("load() must be implemented by subclass")}},{key:"isEqual",value:function(t){throw new Error("isEqual() must be implemented by subclass")}}],e&&c(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function v(t,e,n){return t<e?e:t>n?n:t}function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,w(r.key),r)}}function g(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(g=function(){return!!t})()}function m(t){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(t)}function x(t,e){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},x(t,e)}function I(t,e,n){return(e=w(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function w(t){var e=function(t){if("object"!=d(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==d(e)?e:e+""}var P=function(t){function e(t,n,r,i){var o,s,a,u,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),I(u=function(t,e,n){return e=m(e),function(t,e){if(e&&("object"==d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,g()?Reflect.construct(e,n||[],m(t).constructor):e.apply(t,n))}(this,e,[i,n,r]),"type","CPOINT"),I(u,"isControlPoint",!1),u.parent=t,u.r=null!==(o=l.radius)&&void 0!==o?o:8,u.hitScale=Math.max(1,null!==(s=l.hitScale)&&void 0!==s?s:1),u.col=null!==(a=l.color)&&void 0!==a?a:i.color(0,255,255),u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}(e,t),n=e,r=[{key:"set",value:function(t){return"number"==typeof t.x&&(this.x=t.x),"number"==typeof t.y&&(this.y=t.y),this}},{key:"moveToMouse",value:function(){var t=this.getLocalMouse(),e=t.mxLocal,n=t.myLocal;return this.moveTo(e,n),this}},{key:"setControlPoint",value:function(t){return this.isControlPoint=!!t,this}},{key:"setRadius",value:function(t){return this.r=Math.max(1,t),this}},{key:"setColor",value:function(t){return this.col=t,this}},{key:"setHitScale",value:function(t){return this.hitScale=Math.max(1,t),this}},{key:"isMouseOver",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pInst.mouseX,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.pInst.mouseY,n=this.toLocal(t,e),r=n.mxLocal,i=n.myLocal,o=r-this.x,s=i-this.y;return o*o+s*s<=Math.pow(this.r*this.hitScale,2)}},{key:"interpolateBetween",value:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.col,e=this.pInst;if("function"!=typeof e.isMovingPoints||e.isMovingPoints()){var n=t;this.isMouseOver()&&(n=e.color(255)),e.push(),e.stroke(n),e.strokeWeight(2),e.noFill(),e.ellipse(this.x,this.y,2*this.r),e.fill(n),e.noStroke(),e.ellipse(this.x,this.y,this.r),e.pop()}}},{key:"toJSON",value:function(){return{x:this.x,y:this.y,dragging:this.getIsDragging(),enabled:this.getIsEnabled(),isControlPoint:this.isControlPoint,r:this.r}}},{key:"toLocal",value:function(t,e){var n,r,i,o,s,a=this.pInst,u=!(null==a||null===(n=a._renderer)||void 0===n||!n.isP3D),l=null!==(r=null===(i=this.parent)||void 0===i?void 0:i.x)&&void 0!==r?r:0,h=null!==(o=null===(s=this.parent)||void 0===s?void 0:s.y)&&void 0!==o?o:0;return{mxLocal:(u?t-a.width/2:t)-l,myLocal:(u?e-a.height/2:e)-h}}},{key:"getLocalMouse",value:function(){return this.toLocal(this.pInst.mouseX,this.pInst.mouseY)}}],r&&b(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(y);function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function S(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,O(r.key),r)}}function O(t){var e=function(t){if("object"!=k(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==k(e)?e:e+""}function C(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(C=function(){return!!t})()}function M(t,e,n,r){var i=j(T(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof i?function(t){return i.apply(n,t)}:i}function j(){return j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=T(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},j.apply(null,arguments)}function T(t){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},T(t)}function E(t,e){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},E(t,e)}var _=function(t){function e(t,n,r,i,o,s){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(a=function(t,e,n){return e=T(e),function(t,e){if(e&&("object"==k(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,C()?Reflect.construct(e,n||[],T(t).constructor):e.apply(t,n))}(this,e,[t,n,r,s])).u=i,a.v=o,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&E(t,e)}(e,t),n=e,(r=[{key:"set",value:function(t){return M(e,"set",this,3)([t]),this.u=t.u||0,this.v=t.v||0,this}},{key:"moveTo",value:function(){M(e,"moveTo",this,3)([]),this.parent.calculateMesh()}},{key:"interpolateTo",value:function(t,n){var r=this.x+(t.x-this.x)*n,i=this.y+(t.y-this.y)*n;return new e(this.parent,r,i,0,0,this.pInst)}}])&&S(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(P);function A(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0},r=t.x,i=t.y,o=!1,s=0,a=e.length-1;s<e.length;a=s++){var u=e[s].x+n.x,l=e[s].y+n.y,h=e[a].x+n.x,c=e[a].y+n.y;l>i!=c>i&&r<(h-u)*(i-l)/(c-l)+u&&(o=!o)}return o}function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function D(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,N(r.key),r)}}function L(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(L=function(){return!!t})()}function z(t){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},z(t)}function G(t,e){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},G(t,e)}function N(t){var e=function(t){if("object"!=B(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==B(e)?e:e+""}var V=function(t){function e(t,n,r,i,o,s,a){var u,l,h;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),u=function(t,e,n){return e=z(e),function(t,e){if(e&&("object"==B(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,L()?Reflect.construct(e,n||[],z(t).constructor):e.apply(t,n))}(this,e,[a,0,0]),l=u,(h=N(h="rafHandle"))in l?Object.defineProperty(l,h,{value:null,enumerable:!0,configurable:!0,writable:!0}):l[h]=null,u.pInst=a,!Number.isInteger(i)||i<2)throw new Error("Surface: res must be an integer >= 2 (got ".concat(i,")"));return u.id=t,u.type=o,u.res=i,u.width=u.pInst.constrain(n,0,Math.max(0,u.pInst.width)),u.height=u.pInst.constrain(r,0,Math.max(0,u.pInst.height)),u.controlPointColor=function(t,e,n){var r=88*(1+t)+80*(e?e.charCodeAt(0):2);n.colorMode(n.HSB,255);var i=n.color(r%255,255,255);return n.colorMode(n.RGB,255),i}(u.id,u.type,u.pInst),u.buffer=null!=s?s:u.createBuffer(u.width,u.height),u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&G(t,e)}(e,t),n=e,r=[{key:"createBuffer",value:function(t,e){var n=this.pInst.createGraphics(Math.max(1,Math.floor(t)),Math.max(1,Math.floor(e)));return n.clear(),n}},{key:"getMutedControlColor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.controlPointColor,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=this.pInst;return n.color(n.red(t),n.green(t),n.blue(t),e)}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pInst.color("black");!this.buffer||this.buffer.width<=0||this.buffer.height<=0||(this.buffer.push(),this.buffer.clear(),this.buffer.background(t),this.buffer.pop(),this.displayTexture(this.buffer))}},{key:"displaySurface",value:function(){console.warn("Surface.displaySurface() should be overridden by subclass.")}},{key:"displaySketch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.buffer||(this.buffer=this.createBuffer(this.width,this.height));var o=this.buffer;o.push(),o.clear(),t(o),o.pop(),this.displayTexture(o,e,n,r,i)}},{key:"displayTexture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!(!t||t.width<=0||t.height<=0)){r<=0&&(r=t.width),i<=0&&(i=t.height);var o=e/t.width,s=n/t.height,a=(e+r)/t.width,u=(n+i)/t.height,l=this.pInst;l.push(),l.noStroke(),l.translate(this.x,this.y),l.textureMode(l.NORMAL),l.texture(t),this.displaySurface(!0,o,s,a,u),l.isCalibratingMapper()&&this.displayCalibration(),l.pop()}}},{key:"displayCalibration",value:function(){var t=this.pInst;t.push(),this.displayOutline(),t.pop()}},{key:"displayOutline",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.controlPointColor,e=this.pInst;e.push(),e.strokeWeight(3),e.stroke(t),e.fill(this.getMutedControlColor()),e.translate(this.x,this.y),this.displaySurface(!1),e.pop()}},{key:"isEqual",value:function(t){return t&&t.id.toString()===this.id.toString()&&t.type===this.type}},{key:"getBounds",value:function(t){if(!t||0===t.length)return{x:0,y:0,w:0,h:0};var e,n=1/0,r=1/0,i=-1/0,o=-1/0,s=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return R(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}(t);try{for(s.s();!(e=s.n()).done;){var a=e.value;a.x<n&&(n=a.x),a.y<r&&(r=a.y),a.x>i&&(i=a.x),a.y>o&&(o=a.y)}}catch(t){s.e(t)}finally{s.f()}return n=Math.floor(n),r=Math.floor(r),i=Math.ceil(i),o=Math.ceil(o),{x:n,y:r,w:Math.max(0,i-n),h:Math.max(0,o-r)}}},{key:"setDimensions",value:function(t){var e=this.getBounds(t),n=e.w,r=e.h;this.setSize(n,r)}},{key:"setSize",value:function(t,e){var n=Math.max(0,Math.floor(t)),r=Math.max(0,Math.floor(e));n===this.width&&r===this.height||(this.width=n,this.height=r,this.buffer=this.createBuffer(this.width,this.height),this.scheduleCalculateMesh())}},{key:"scheduleCalculateMesh",value:function(){var t=this;if(null==this.rafHandle){var e="undefined"!=typeof window&&window.requestAnimationFrame;this.rafHandle=e?e(function(){t.rafHandle=null,"function"==typeof t.calculateMesh&&t.calculateMesh()}):setTimeout(function(){t.rafHandle=null,"function"==typeof t.calculateMesh&&t.calculateMesh()},0)}}},{key:"displayControlPoints",value:function(){}},{key:"toJSON",value:function(){return{id:this.id,type:this.type,res:this.res,x:this.x,y:this.y,width:this.width,height:this.height}}}],r&&D(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(y);function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}function Y(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=U(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function U(t,e){if(t){if("string"==typeof t)return X(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function J(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,q(r.key),r)}}function H(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(H=function(){return!!t})()}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},F(t)}function Q(t,e){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Q(t,e)}function $(t,e,n){return(e=q(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function q(t){var e=function(t){if("object"!=W(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=W(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==W(e)?e:e+""}var Z=function(t){function e(t,n,r,i,o,s,a){var u;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),$(u=function(t,e,n){return e=F(e),function(t,e){if(e&&("object"==W(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,H()?Reflect.construct(e,n||[],F(t).constructor):e.apply(t,n))}(this,e,[t,n,r,i,o,s,a]),"mesh",[]),$(u,"TL",0),$(u,"TR",0),$(u,"BR",0),$(u,"BL",0),$(u,"controlPoints",[]),$(u,"perspectiveTransform",null),!Number.isInteger(i)||i<2)throw new Error("CornerPinSurface: res must be an integer >= 2, got ".concat(i));return u.res=i,u.initMesh(),u.calculateMesh(),u}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Q(t,e)}(e,t),n=e,(r=[{key:"idx",value:function(t,e){return e*this.res+t}},{key:"forEachPoint",value:function(t){for(var e=0,n=0;n<this.res;n++)for(var r=0;r<this.res;r++,e++)t(this.mesh[e],r,n,e)}},{key:"initMesh",value:function(){var t=this;this.mesh=new Array(this.res*this.res);for(var e=function(e){return e/(t.res-1)*t.width},n=function(e){return e/(t.res-1)*t.height},r=function(e){return e/(t.res-1)},i=function(e){return e/(t.res-1)},o=0;o<this.res;o++)for(var s=0;s<this.res;s++){var a=Math.round(e(s)),u=Math.round(n(o)),l=r(s),h=i(o);this.mesh[this.idx(s,o)]=new _(this,a,u,l,h,this.pInst)}this.TL=this.idx(0,0),this.TR=this.idx(this.res-1,0),this.BL=this.idx(0,this.res-1),this.BR=this.idx(this.res-1,this.res-1),[this.TL,this.TR,this.BR,this.BL].forEach(function(e){t.mesh[e].setControlPoint(!0)}),this.controlPoints=[this.mesh[this.TL],this.mesh[this.TR],this.mesh[this.BR],this.mesh[this.BL]]}},{key:"calculateMesh",value:function(){}},{key:"setPerspectiveTransform",value:function(t){this.perspectiveTransform=t}},{key:"load",value:function(t){var e=t.x,n=t.y,r=t.points;this.x=e,this.y=n;var i,o=Y(r||[]);try{for(o.s();!(i=o.n()).done;){var s=i.value,a=this.mesh[s.i];a&&(a.x=s.x,a.y=s.y,a.u=s.u||0,a.v=s.v||0,a.setControlPoint(!0))}}catch(t){o.e(t)}finally{o.f()}this.calculateMesh()}},{key:"toJSON",value:function(){var t={id:String(this.id),res:this.res,x:this.x,y:this.y,width:this.width,height:this.height,type:this.type,points:[]};return this.forEachPoint(function(e,n,r,i){var o;e.isControlPoint&&(null===(o=t.points)||void 0===o||o.push({i,x:e.x,y:e.y,u:e.u,v:e.v}))}),t}},{key:"getControlPoints",value:function(){return this.controlPoints}},{key:"selectPoints",value:function(){var t=this.isMouseOverControlPoints();return t?(t.startDrag(),t):null}},{key:"isMouseOverControlPoints",value:function(){var t,e=Y(this.controlPoints);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(n.isMouseOver())return n}}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isPointInTriangle",value:function(t,e,n,r,i){var o=i.x-n.x,s=i.y-n.y,a=r.x-n.x,u=r.y-n.y,l=t-n.x,h=e-n.y,c=o*o+s*s,f=a*o+u*s,p=l*o+h*s,y=a*a+u*u,v=l*a+h*u,d=1/(c*y-f*f),b=(y*p-f*v)*d,g=(c*v-f*p)*d;return b>0&&g>0&&b+g<1}},{key:"displayControlPoints",value:function(){var t=this.pInst;t.push(),t.translate(this.x,this.y);var e,n=Y(this.controlPoints);try{for(n.s();!(e=n.n()).done;)e.value.display(this.controlPointColor)}catch(t){n.e(t)}finally{n.f()}t.pop()}},{key:"getTransformedCursor",value:function(t,e){if(!this.perspectiveTransform)return this.pInst.createVector(t-this.x,e-this.y);var n=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,s,a=[],u=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(t,e)||U(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.perspectiveTransform.transform([t-this.x,e-this.y]),2),r=n[0],i=n[1];return this.pInst.createVector(r,i)}},{key:"getTransformedMouse",value:function(){var t=this.getMouseCoords(),e=t.x,n=t.y;return this.getTransformedCursor(e,n)}},{key:"cross2",value:function(t,e,n,r){return t*r-e*n}}])&&J(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function tt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,s,a=[],u=!0,l=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(t){l=!0,i=t}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return et(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function et(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function nt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,rt(r.key),r)}}function rt(t){var e=function(t){if("object"!=K(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==K(e)?e:e+""}function it(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(it=function(){return!!t})()}function ot(t){return ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ot(t)}function st(t,e){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},st(t,e)}var at=function(t){function e(t,n,r,i,o,s){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(a=function(t,e,n){return e=ot(e),function(t,e){if(e&&("object"==K(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,it()?Reflect.construct(e,n||[],ot(t).constructor):e.apply(t,n))}(this,e,[t,n,r,i,"QUAD",o,s])).resX=a.res,a.resY=a.res,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&st(t,e)}(e,t),n=e,r=[{key:"isMouseOver",value:function(){var t=this.getMouseCoords(),e=t.x,n=t.y,r=e-this.x,i=n-this.y;return this.isPointInTriangle(r,i,this.mesh[this.TL],this.mesh[this.TR],this.mesh[this.BL])||this.isPointInTriangle(r,i,this.mesh[this.BL],this.mesh[this.TR],this.mesh[this.BR])}},{key:"calculateMesh",value:function(){for(var t=[0,0,this.width,0,this.width,this.height,0,this.height],e=[this.mesh[this.TL].x,this.mesh[this.TL].y,this.mesh[this.TR].x,this.mesh[this.TR].y,this.mesh[this.BR].x,this.mesh[this.BR].y,this.mesh[this.BL].x,this.mesh[this.BL].y],n=u(t,e),r=this.width/(this.resX-1),i=this.height/(this.resY-1),o=0;o<this.resY;o++)for(var s=0;s<this.resX;s++){var a=o*this.res+s;if(a!==this.TL&&a!==this.TR&&a!==this.BR&&a!==this.BL){var l=s*r,h=o*i,c=tt(n.transform(l,h),2),f=c[0],p=c[1];this.mesh[a].x=f,this.mesh[a].y=p}}}},{key:"displaySurface",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=this.pInst;o.beginShape(o.TRIANGLES);for(var s=0;s<this.resX-1;s++)for(var a=0;a<this.resY-1;a++)t?this.emitQuadAsTrianglesUV(s,a,e,n,r,i):this.emitQuadAsTrianglesOutline(s,a);o.endShape()}},{key:"displayCalibration",value:function(){this.displayGrid()}},{key:"displayGrid",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.controlPointColor,e=this.pInst;e.strokeWeight(2),e.stroke(t),e.fill(this.getMutedControlColor(t)),e.beginShape(e.TRIANGLES);for(var n=0;n<this.resX-1;n++)for(var r=0;r<this.resY-1;r++)this.emitQuadAsTrianglesOutline(n,r);e.endShape()}},{key:"emitQuadAsTrianglesUV",value:function(t,e,n,r,i,o){var s=this,a=e*this.res+t,u=e*this.res+(t+1),l=(e+1)*this.res+(t+1),h=(e+1)*this.res+t,c=function(t){var e=s.mesh[t],a=n+e.u*(i-n),u=r+e.v*(o-r);s.pInst.vertex(e.x,e.y,a,u)};c(a),c(u),c(l),c(a),c(l),c(h)}},{key:"emitQuadAsTrianglesOutline",value:function(t,e){var n=this,r=e*this.res+t,i=e*this.res+(t+1),o=(e+1)*this.res+(t+1),s=(e+1)*this.res+t,a=function(t){var e=n.mesh[t];n.pInst.vertex(e.x,e.y)};a(r),a(i),a(o),a(r),a(o),a(s)}},{key:"setResolution",value:function(t){var e,n=Math.max(2,Math.floor(t));n!==this.res&&(this.res=n,this.resX=n,this.resY=n,null===(e=this.initMesh)||void 0===e||e.call(this),this.calculateMesh())}}],r&&nt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Z);function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ht(r.key),r)}}function ht(t){var e=function(t){if("object"!=ut(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ut(e)?e:e+""}function ct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ct=function(){return!!t})()}function ft(t){return ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ft(t)}function pt(t,e){return pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pt(t,e)}var yt=function(t){function e(t,n,r,i,o,s){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(a=function(t,e,n){return e=ft(e),function(t,e){if(e&&("object"==ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ct()?Reflect.construct(e,n||[],ft(t).constructor):e.apply(t,n))}(this,e,[t,n,r,i,"TRI",o,s])).setTriMesh(),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pt(t,e)}(e,t),n=e,r=[{key:"isMouseOver",value:function(){var t=this.getMouseCoords(),e=t.x,n=t.y,r=e-this.x,i=n-this.y;return this.isPointInTriangle(r,i,this.mesh[this.TP],this.mesh[this.BL],this.mesh[this.BR])}},{key:"setTriMesh",value:function(){var t=Math.floor((this.res-1)/2);this.TP=0*this.res+t,this.mesh[this.TP].setControlPoint(!0),this.mesh[this.TL].setControlPoint(!1),this.mesh[this.TR].setControlPoint(!1),this.mesh[this.BL].setControlPoint(!0),this.mesh[this.BR].setControlPoint(!0),this.controlPoints=[this.mesh[this.TP],this.mesh[this.BL],this.mesh[this.BR]]}},{key:"displaySurface",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=this.pInst,s=this.mesh[this.TP],a=this.mesh[this.BL],u=this.mesh[this.BR],l={u0:e,v0:n,u1:r,v1:i},h=.5*(l.u0+l.u1);o.beginShape(o.TRIANGLES),t?o.vertex(a.x,a.y,l.u0,l.v1):o.vertex(a.x,a.y),t?o.vertex(s.x,s.y,h,l.v0):o.vertex(s.x,s.y),t?o.vertex(u.x,u.y,l.u1,l.v1):o.vertex(u.x,u.y),o.endShape(o.CLOSE)}},{key:"displayCalibration",value:function(){var t=this.pInst,e=this.mesh[this.TP],n=this.mesh[this.BL],r=this.mesh[this.BR];t.push(),t.strokeWeight(2),t.stroke(this.controlPointColor),t.fill(this.getMutedControlColor()),t.beginShape(),t.vertex(n.x,n.y),t.vertex(e.x,e.y),t.vertex(r.x,r.y),t.endShape(t.CLOSE),t.pop()}}],r&&lt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(Z);function vt(t){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(t)}function dt(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return bt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function gt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wt(r.key),r)}}function mt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(mt=function(){return!!t})()}function xt(t){return xt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xt(t)}function It(t,e){return It=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},It(t,e)}function wt(t){var e=function(t){if("object"!=vt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vt(e)?e:e+""}var Pt=function(t){function e(t,n,r,i){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,n){(e=wt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(o=function(t,e,n){return e=xt(e),function(t,e){if(e&&("object"==vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,mt()?Reflect.construct(e,n||[],xt(t).constructor):e.apply(t,n))}(this,e,[t,0,0,2,"POLY",r,i]),"points",[]);for(var s=0;s<n;s++){var a=200,u=s/n*2*o.pInst.PI,l=a+a*Math.cos(u),h=a+a*Math.sin(u),c=new P(o,l,h,o.pInst).setControlPoint(!0);o.points.push(c)}return o.setDimensions(o.points),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&It(t,e)}(e,t),n=e,r=[{key:"setPoints",value:function(t){this.points=[];var e,n=dt(t);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=new P(this,r.x,r.y,this.pInst).setControlPoint(!0);this.points.push(i)}}catch(t){n.e(t)}finally{n.f()}this.setDimensions(this.points)}},{key:"displaySurface",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(0!==this.points.length){var o=this.getBounds(this.points),s=o.x,a=o.y,u=o.w,l=o.h,h=u>0?u:1,c=l>0?l:1,f=function(t){return e+(t-s)/h*(r-e)},p=function(t){return n+(t-a)/c*(i-n)},y=this.pInst;y.beginShape();var v,d=dt(this.points);try{for(d.s();!(v=d.n()).done;){var b=v.value;t?y.vertex(b.x,b.y,f(b.x),p(b.y)):y.vertex(b.x,b.y)}}catch(t){d.e(t)}finally{d.f()}y.endShape(y.CLOSE)}}},{key:"displayOutline",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.controlPointColor,e=this.pInst;e.push(),e.strokeWeight(3),e.stroke(t),e.fill(this.getMutedControlColor()),this.displaySurface(!1),e.pop()}},{key:"displayControlPoints",value:function(){var t=this.pInst;t.push(),t.translate(this.x,this.y,2);var e,n=dt(this.points);try{for(n.s();!(e=n.n()).done;)e.value.display(this.controlPointColor)}catch(t){n.e(t)}finally{n.f()}t.pop()}},{key:"isMouseOver",value:function(){return A(this.getMouseCoords(),this.points,{x:this.x,y:this.y})}},{key:"load",value:function(t){var e=t.x,n=t.y,r=t.points;this.x=e,this.y=n;var i,o=dt(r||[]);try{for(o.s();!(i=o.n()).done;){var s=i.value,a=this.points[s.i];a&&(a.x=s.x,a.y=s.y)}}catch(t){o.e(t)}finally{o.f()}this.setDimensions(this.points)}},{key:"toJSON",value:function(){for(var t={id:this.id,x:this.x,y:this.y,type:"POLY",points:[]},e=0;e<this.points.length;e++){var n;null===(n=t.points)||void 0===n||n.push({i:e,x:this.points[e].x,y:this.points[e].y})}return t}},{key:"selectPoints",value:function(){var t,e=dt(this.points);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(n.isMouseOver())return n.startDrag(),n}}catch(t){e.e(t)}finally{e.f()}return null}}],r&&gt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function St(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Tt(r.key),r)}}function Ot(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ot=function(){return!!t})()}function Ct(t){return Ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ct(t)}function Mt(t,e){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Mt(t,e)}function jt(t,e,n){return(e=Tt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Tt(t){var e=function(t){if("object"!=kt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kt(e)?e:e+""}var Et=function(t){function e(t,n,r,i){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),jt(o=function(t,e,n){return e=Ct(e),function(t,e){if(e&&("object"==kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ot()?Reflect.construct(e,n||[],Ct(t).constructor):e.apply(t,n))}(this,e,[i,t,n]),"type","CPOINT"),jt(o,"r",8),o.pInst=i,o.pos=i.createVector(t,n),o.parentPath=r,o.type="CPOINT",o.r=8,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mt(t,e)}(e,t),n=e,(r=[{key:"add",value:function(t,e){this.pos.add(t,e)}},{key:"set",value:function(t){var e=t.x,n=t.y;return this.pos.set(e||0,n||0),this}},{key:"isMouseOver",value:function(){var t=this.pos.x+this.parentPath.x,e=this.pos.y+this.parentPath.y,n=this.pInst.mouseX-this.pInst.width/2,r=this.pInst.mouseY-this.pInst.height/2;return this.pInst.dist(t,e,n,r)<5}},{key:"moveTo",value:function(){var t,e,n,r,i,o=this.pInst.mouseX-this.pInst.width/2-this.parentPath.x,s=this.pInst.mouseY-this.pInst.height/2-this.parentPath.y,a=this.parentPath,u=a.points.indexOf(this);if(u%3==0){var l=o-this.pos.x,h=s-this.pos.y;this.pos.set(o,s),a.points[a.loopIndex(u-1)].add(l,h),a.points.length,a.points[a.loopIndex(u+1)].add(l,h),"AUTOMATIC"==a.mode&&a.autoSetAllControlPoints()}else if("AUTOMATIC"!=a.mode){this.pos.set(o,s);var c=u%3==1?u-1:u+1,f=u%3==1?u-2:u+2;f>=0&&a.points.length;var p=a.points[a.loopIndex(c)].pos,y=a.points[a.loopIndex(f)].pos;if("ALIGNED"==a.mode){var v=function(t,e,n,r){var i=t-n,o=e-r;return Math.hypot(i,o)}(p.x,p.y,y.x,y.y);!function(t,e,n,r,i,o){var s=e-r,a=n-i,u=Math.hypot(s,a)||1;s=s/u*o,a=a/u*o,t.set(e+s,n+a)}(y,p.x,p.y,this.pos.x,this.pos.y,v)}else"MIRRORED"==a.mode&&(t=y,e=p.x,n=p.y,r=this.pos.x,i=this.pos.y,t.set(2*e-r,2*n-i))}a.setDimensions()}},{key:"isAnchor",value:function(){return this.parentPath.points.indexOf(this)%3==0}},{key:"displayControlCircle",value:function(t,e){var n=this.parentPath.points.indexOf(this),r=t,i=e;this.isMouseOver()&&(r=this.pInst.color(255),i=this.pInst.color(200)),this.pInst.stroke(r),this.pInst.strokeWeight(2),n%3==0?this.displayCircle(r,this.r):this.parentPath.auto||this.displayCircle(i,this.r-2)}},{key:"displayCircle",value:function(t,e){this.pInst.noFill(),this.pInst.stroke(t),this.pInst.ellipse(this.pos.x,this.pos.y,2*e),this.pInst.noStroke(),this.pInst.fill(t),this.pInst.ellipse(this.pos.x,this.pos.y,e)}}])&&St(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(y);function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function At(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Bt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function Bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Rt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Vt(r.key),r)}}function Dt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Dt=function(){return!!t})()}function Lt(){return Lt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=zt(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},Lt.apply(null,arguments)}function zt(t){return zt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zt(t)}function Gt(t,e){return Gt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gt(t,e)}function Nt(t,e,n){return(e=Vt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Vt(t){var e=function(t){if("object"!=_t(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=_t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_t(e)?e:e+""}var Wt=function(t){function e(t,n,r,i){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Nt(o=function(t,e,n){return e=zt(e),function(t,e){if(e&&("object"==_t(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Dt()?Reflect.construct(e,n||[],zt(t).constructor):e.apply(t,n))}(this,e,[t,0,0,2,"BEZ",r.buffer,i]),"mode","FREE"),Nt(o,"r",8),Nt(o,"points",[]),Nt(o,"closed",!0),Nt(o,"auto",!1),Nt(o,"bufferSpace",10),Nt(o,"shaderProg",null),o.pMapper=r,o.width=100,o.height=100,o.initEmpty(n),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gt(t,e)}(e,t),n=e,r=[{key:"initEmpty",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this.points=[],this.x=0,this.y=0;var e=100,n=e*Math.cos(0),r=e*Math.sin(0),i=-50*Math.cos(Math.PI/2),o=50*Math.sin(Math.PI/2);this.points.push(new Et(n,r,this,this.pInst)),this.points.push(new Et(n+i,r+o,this,this.pInst));for(var s=1;s<t;s++){var a=2*s*Math.PI/t,u=e*Math.cos(a),l=e*Math.sin(a),h=-50*Math.cos(Math.PI/2-a),c=50*Math.sin(Math.PI/2-a),f=-h,p=-c;this.points.push(new Et(u+f,l+p,this,this.pInst)),this.points.push(new Et(u,l,this,this.pInst)),this.points.push(new Et(u+h,l+c,this,this.pInst))}var y=this.points[this.points.length-1].pos;this.points.push(new Et(y.x,y.y,this,this.pInst)),this.closed=!0,this.auto=!1,this.setDimensions()}},{key:"setAlignedMode",value:function(){this.mode="ALIGNED"}},{key:"setMirroredMode",value:function(){this.mode="MIRRORED"}},{key:"setFreeMode",value:function(){this.mode="FREE"}},{key:"setAutomaticMode",value:function(){this.mode="AUTOMATIC"}},{key:"setBezierDetail",value:function(){var t,e,n,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;null===(t=this.pMapper.bezBuffer)||void 0===t||null===(e=t.bezierDetail)||void 0===e||e.call(t,i),null===(n=this.pMapper.buffer)||void 0===n||null===(r=n.bezierDetail)||void 0===r||r.call(n,i)}},{key:"isReady",value:function(){return Boolean(this.pMapper.bezBuffer&&this.pMapper.bezierShaderLoaded)}},{key:"load",value:function(t){this.points=[],this.x=t.x,this.y=t.y,this.closed=t.closed||!1,this.auto=t.auto||!1;var e,n=At(t.points||[]);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.points.push(new Et(r.x,r.y,this,this.pInst))}}catch(t){n.e(t)}finally{n.f()}this.setDimensions()}},{key:"getJson",value:function(){return{id:this.id,type:"BEZ",x:this.x,y:this.y,points:this.points.map(function(t){return{x:t.pos.x,y:t.pos.y}}),closed:this.closed,auto:this.auto}}},{key:"serialize",value:function(){return JSON.stringify(this.getJson())}},{key:"selectPoints",value:function(){return this.selectControls()||this.selectAnchors()}},{key:"selectAnchors",value:function(){for(var t=0;t<this.points.length;t+=3){var e=this.points[t];if(e.isMouseOver())return e}return null}},{key:"selectControls",value:function(){var t,e=At(this.points);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(!n.isAnchor()&&n.isMouseOver())return n}}catch(t){e.e(t)}finally{e.f()}return null}},{key:"getBounds",value:function(){var t,n,r,i=this.getPolyline();return(t=e,n=this,"function"==typeof(r=Lt(zt(1&3?t.prototype:t),"getBounds",n))?function(t){return r.apply(n,t)}:r)([i])}},{key:"loopIndex",value:function(t){return(t+this.points.length)%this.points.length}},{key:"toggleClosed",value:function(){if(this.closed)this.closed=!1,this.points.pop(),this.points.pop();else{this.closed=!0;var t=this.points[this.points.length-1].pos,e=this.points[this.points.length-2].pos,n=this.points[0].pos,r=this.points[1].pos,i=this.pInst.constructor.Vector.lerp(t,e,-1),o=new Et(i.x,i.y,this,this.pInst),s=this.pInst.constructor.Vector.lerp(n,r,-1),a=new Et(s.x,s.y,this,this.pInst);this.points.push(o,a)}this.setDimensions()}},{key:"setDimensions",value:function(){var t=this.getBounds(),e=t.w,n=t.h;this.width=e+2*this.bufferSpace,this.height=n+2*this.bufferSpace;var r=this.pMapper.bezBuffer;this.displayBezierPG(r)}},{key:"numSegments",value:function(){return Math.floor(this.points.length/3)}},{key:"getSegment",value:function(t){return[this.points[this.loopIndex(3*t+0)],this.points[this.loopIndex(3*t+1)],this.points[this.loopIndex(3*t+2)],this.points[this.loopIndex(3*t+3)]]}},{key:"addSegment",value:function(t,e){var n=this.getMouseCoords(),r=n.x,i=n.y;"number"!=typeof t&&(t=r-this.x),"number"!=typeof e&&(e=i-this.y);var o=this.getClosestAnchor(),s=this.getNextClosestAnchor(),a=this.points[o+1].pos,u=s-1;-1===u&&(u=this.points.length-1);var l=this.points[u].pos,h=this.pInst.createVector(t,e),c=new Et(h.x,h.y,this,this.pInst),f=this.pInst.constructor.Vector.lerp(a,h,.7),p=this.pInst.constructor.Vector.lerp(h,l,.3),y=new Et(f.x,f.y,this,this.pInst),v=new Et(p.x,p.y,this,this.pInst);this.points.splice(o+2,0,y,c,v),this.setDimensions()}},{key:"removeSegment",value:function(){if(this.points.length<=3)console.warn("cannot have a bezier with less than one anchor");else for(var t=0;t<this.points.length;t+=3)if(this.points[t].isMouseOver())return this.points.splice(t,3),void this.setDimensions()}},{key:"getClosestAnchor",value:function(){for(var t=this.getMouseCoords(),e=t.x,n=t.y,r=e-this.x,i=n-this.y,o=1/0,s=0,a=0;a<this.points.length;a+=3){var u=this.points[a],l=a>=this.points.length-3?this.points[0]:this.points[a+3],h=this.pInst.dist(u.pos.x,u.pos.y,r,i)+this.pInst.dist(l.pos.x,l.pos.y,r,i);h<o&&(o=h,s=a)}return s}},{key:"getNextClosestAnchor",value:function(){var t=this.getClosestAnchor()+3;return t>this.points.length-3&&(t=0),t}},{key:"autoSetControlPoint",value:function(t,e){if(!(t-3<0||t+3>=this.points.length)||this.closed){var n=this.loopIndex(t-3),r=this.loopIndex(t+3),i=this.points[t].pos,o=this.points[n].pos,s=this.points[r].pos,a=this.pInst.constructor.Vector,u=a.sub(a.copy(o),i),l=a.sub(a.copy(s),i),h=u.mag(),c=l.mag();u.normalize(),l.normalize();var f=a.sub(u,l),p=a.sub(l,u);f.setMag(h*e),p.setMag(c*e),this.points[this.loopIndex(t-1)].set(a.add(a.copy(i),f)),this.points[this.loopIndex(t+1)].set(a.add(a.copy(i),p))}}},{key:"autoSetEdgePoints",value:function(t){if(!this.closed){var e=this.pInst.constructor.Vector;this.points[1].set(e.lerp(this.points[0].pos,this.points[2].pos,t)),this.points[this.points.length-2].set(e.lerp(this.points[this.points.length-1].pos,this.points[this.points.length-3].pos,t))}}},{key:"autoSetAllControlPoints",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.3,e=0;e<this.points.length;e+=3)this.autoSetControlPoint(e,t);this.autoSetEdgePoints(t),this.setDimensions()}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pInst.color("black");this.pInst.noStroke(),this.pInst.fill(t),this.displayBezier(),this.displayCalib()}},{key:"displayCalib",value:function(){this.pInst.isCalibratingMapper()&&(this.pInst.strokeWeight(3),this.pInst.stroke(this.controlPointColor),this.pInst.fill(this.getMutedControlColor()),this.displayBezier())}},{key:"displayTexture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(this.isReady()){var o=this.pMapper.buffer;this.drawImage(t,o,e,n,r,i),this.displayGraphicsTexture(o),this.displayCalib()}}},{key:"displaySketch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.pMapper.buffer;r.push(),r.translate(e,n),t(r),r.pop(),this.displayGraphicsTexture(r)}},{key:"displayGraphicsTexture",value:function(t){if(this.isReady()){this.setDimensions();var e=this.pMapper.bezBuffer,n=this.pMapper.bufferWEBGL;this.shaderProg||(this.shaderProg=n.createShader("#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vTexCoord = aTexCoord;\n  vec4 positionVec4 = vec4(aPosition, 1.0);\n  positionVec4.xy = positionVec4.xy * 2.0 - 1.0; // NDC\n  gl_Position = positionVec4;\n}","#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 vTexCoord;\nuniform sampler2D texMask;\nuniform sampler2D texImg;\n\nvoid main() {\n  vec2 uv = vec2(vTexCoord.x, 1.0 - vTexCoord.y); // flip Y\n  vec4 maskT = texture2D(texMask, uv);\n  vec4 imgT  = texture2D(texImg,  uv);\n\n  float gray = (maskT.r + maskT.g + maskT.b) / 3.0;\n  vec3 outRGB = imgT.rgb * gray;\n\n  gl_FragColor = vec4(outRGB, gray);\n}")),n.clear(),n.setAttributes("alpha",!0),n.shader(this.shaderProg),this.shaderProg.setUniform("texMask",e),this.shaderProg.setUniform("texImg",t),n.rect(0,0,this.pInst.width,this.pInst.height);var r=this.getBounds(),i=r.x,o=r.y;this.pInst.push(),this.pInst.translate(this.x,this.y),this.pInst.translate(i-this.bufferSpace,o-this.bufferSpace),this.pInst.image(n,0,0),this.pInst.pop(),this.displayCalib()}}},{key:"drawImage",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;t&&e&&(i<=0&&(i=t.width),o<=0&&(o=t.height),e.push(),e.clear(),e.translate(n,r),e.image(t,0,0,i,o),e.pop())}},{key:"displayBezierPG",value:function(t){var e=this.getBounds(),n=e.x,r=e.y;t.push(),t.clear(),t.fill("white"),t.translate(-n,-r),t.translate(this.bufferSpace,this.bufferSpace),t.beginShape(),t.vertex(this.points[0].pos.x,this.points[0].pos.y);for(var i=0;i<this.numSegments();i++){var o=this.getSegment(i);t.bezierVertex(o[1].pos.x,o[1].pos.y,o[2].pos.x,o[2].pos.y,o[3].pos.x,o[3].pos.y)}t.endShape(),t.pop()}},{key:"displayBezier",value:function(){this.pInst.push(),this.pInst.translate(this.x,this.y),this.pInst.beginShape(),this.pInst.vertex(this.points[0].pos.x,this.points[0].pos.y);for(var t=0;t<this.numSegments();t++){var e=this.getSegment(t);this.pInst.bezierVertex(e[1].pos.x,e[1].pos.y,e[2].pos.x,e[2].pos.y,e[3].pos.x,e[3].pos.y)}this.pInst.endShape(),this.pInst.pop()}},{key:"displayControlPoints",value:function(){var t,e;if(null!==(t=(e=this.pInst).isMovingPoints)&&void 0!==t&&t.call(e)){var n=this.controlPointColor;this.pInst.push(),this.pInst.translate(this.x,this.y);var r=this.pInst.lerpColor(n,this.pInst.color(255,255,255),.5);this.displayControlLines(r),this.displayControlCircles(n,r),this.pInst.pop()}}},{key:"displayControlLines",value:function(t){this.pInst.strokeWeight(2);for(var e=0;e<this.numSegments();e++){var n=this.getSegment(e);this.pInst.stroke(t),this.pInst.line(n[0].pos.x,n[0].pos.y,n[1].pos.x,n[1].pos.y),this.pInst.line(n[2].pos.x,n[2].pos.y,n[3].pos.x,n[3].pos.y)}}},{key:"displayControlCircles",value:function(t,e){this.getClosestAnchor(),this.getNextClosestAnchor();var n,r=At(this.points);try{for(r.s();!(n=r.n()).done;)n.value.displayControlCircle(t,e)}catch(t){r.e(t)}finally{r.f()}}},{key:"getPolyline",value:function(){for(var t=[],e=0;e<this.numSegments();e++)for(var n=this.getSegment(e),r=0;r<=4;r++){var i=r/4,o=this.pInst.bezierPoint(n[0].pos.x,n[1].pos.x,n[2].pos.x,n[3].pos.x,i),s=this.pInst.bezierPoint(n[0].pos.y,n[1].pos.y,n[2].pos.y,n[3].pos.y,i);t.push({x:o,y:s})}return t}},{key:"isMouseOver",value:function(){var t=this.getPolyline();return A(this.getMouseCoords(),t,{x:this.x,y:this.y})}}],r&&Rt(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(V);function Yt(t){return Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yt(t)}function Ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Qt(r.key),r)}}function Xt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Xt=function(){return!!t})()}function Jt(t){return Jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jt(t)}function Ht(t,e){return Ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ht(t,e)}function Ft(t,e,n){return(e=Qt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Qt(t){var e=function(t){if("object"!=Yt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Yt(e)?e:e+""}var $t=function(t){function e(t,n,r,i,o,s){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Ft(a=function(t,e,n){return e=Jt(e),function(t,e){if(e&&("object"==Yt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Xt()?Reflect.construct(e,n||[],Jt(t).constructor):e.apply(t,n))}(this,e,[s,0,0]),"type","LINE"),Ft(a,"lineW",10),Ft(a,"endCapsOn",!0),Ft(a,"lastChecked",0),Ft(a,"ang",0),a.id=o,a.lineC=a.pInst.color(255),a.highlightColor=a.pInst.color(0,255,0),a.controlPointColor=a.getLinearIdColor(a.id),a.p0=new P(a,t,n,a.pInst),a.p1=new P(a,r,i,a.pInst),a.leftToRight(),a.ang=a.pInst.atan2(a.p0.y-a.p1.y,a.p0.x-a.p1.x),a.ang>a.pInst.PI/2&&(a.ang-=2*a.pInst.PI),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ht(t,e)}(e,t),n=e,r=[{key:"load",value:function(t){this.x=t.x,this.y=t.y,this.p0.x=t.x0||0,this.p0.y=t.y0||0,this.p1.x=t.x1||0,this.p1.y=t.y1||0}},{key:"toJSON",value:function(){return{id:this.id,x:this.x,y:this.y,x0:this.p0.x,y0:this.p0.y,x1:this.p1.x,y1:this.p1.y}}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.lineC,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineW;this.pInst.strokeWeight(e),this.pInst.stroke(t),this.pInst.push(),this.pInst.translate(this.x,this.y),this.pInst.line(this.p0.x,this.p0.y,this.p1.x,this.p1.y),this.drawEndCaps(this.p0,this.p1,t,t,e),this.pInst.pop()}},{key:"displayCenterPulse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineC,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.lineW,r=(this.p0.x+this.p1.x)/2,i=(this.p0.y+this.p1.y)/2,o=this.pInst.lerp(r,this.p0.x,t),s=this.pInst.lerp(i,this.p0.y,t),a=this.pInst.lerp(r,this.p1.x,t),u=this.pInst.lerp(i,this.p1.y,t);this.pInst.strokeWeight(n),this.pInst.stroke(e),this.pInst.push(),this.pInst.translate(this.x,this.y),this.pInst.line(o,s,a,u),this.drawEndCaps({x:o,y:s},{x:a,y:u},e,e,n),this.pInst.pop()}},{key:"displayPercent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineC,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.lineW,r=this.pInst.constrain(t,0,1),i=this.pInst.lerp(this.p0.x,this.p1.x,r),o=this.pInst.lerp(this.p0.y,this.p1.y,r);this.pInst.strokeWeight(n),this.pInst.stroke(e),this.pInst.push(),this.pInst.translate(this.x,this.y),this.pInst.line(this.p0.x,this.p0.y,i,o),this.drawEndCaps(this.p0,{x:i,y:o},e,e,n),this.pInst.pop()}},{key:"displayPercentWidth",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineC,n=this.pInst.constrain(t,0,1),r=this.pInst.map(n,0,1,0,10);this.display(e,r)}},{key:"displayNone",value:function(){this.display(this.pInst.color(0))}},{key:"displayRainbowCycle",value:function(){this.pInst.colorMode(this.pInst.HSB,255);var t=this.pInst.color(this.pInst.frameCount%255,255,255);this.display(t),this.pInst.colorMode(this.pInst.RGB,255)}},{key:"displayGradientLine",value:function(t,e,n){for(var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=(n+(arguments.length>3&&void 0!==arguments[3]?arguments[3]:1))%1,o=1/Math.max(1,this.pInst.height),s=0;s<1;s+=o){var a=(s/2+i)%1,u=this.get2CycleColor(t,e,r?1-a:a);this.displaySegment(s,o,u)}}},{key:"getCalibrationColor",value:function(){this.pInst.colorMode(this.pInst.HSB,255);var t=this.pInst.hue(this.controlPointColor),e=this.pInst.color(t,180,255);return this.pInst.colorMode(this.pInst.RGB),e}},{key:"getLinearIdColor",value:function(t){var e="number"==typeof t?t:this.hashString(t.toString());this.pInst.colorMode(this.pInst.HSB,255);var n=15*e%255,r=this.pInst.color(n,255,255);return this.pInst.colorMode(this.pInst.RGB),r}},{key:"displayCalibration",value:function(){this.isMouseOver()?this.display(this.pInst.color(255)):this.display(this.getCalibrationColor())}},{key:"displayControlPoints",value:function(){this.pInst.push(),this.pInst.translate(this.x,this.y),this.p0.display(this.controlPointColor),this.p1.display(this.controlPointColor),this.pInst.pop()}},{key:"setEndCapsOn",value:function(){this.endCapsOn=!0}},{key:"setEndCapsOff",value:function(){this.endCapsOn=!1}},{key:"drawEndCaps",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.lineC,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.lineC,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.lineW;this.endCapsOn&&(this.pInst.dist(t.x,t.y,e.x,e.y)<=1||(this.pInst.noStroke(),this.pInst.fill(n),this.pInst.ellipse(t.x,t.y,i),this.pInst.fill(r),this.pInst.ellipse(e.x,e.y,i)))}},{key:"displaySegment",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.lineC,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.lineW,i=this.pInst.constrain(t,0,1),o=this.pInst.constrain(t+e,0,1),s=this.pInst.lerp(this.p0.x,this.p1.x,i),a=this.pInst.lerp(this.p0.y,this.p1.y,i),u=this.pInst.lerp(this.p0.x,this.p1.x,o),l=this.pInst.lerp(this.p0.y,this.p1.y,o);this.pInst.strokeWeight(r),this.pInst.stroke(n),this.pInst.push(),this.pInst.translate(this.x,this.y),this.pInst.line(s,a,u,l),this.drawEndCaps({x:s,y:a},{x:u,y:l},n,n,r),this.pInst.pop()}},{key:"get2CycleColor",value:function(t,e,n){var r=2*this.pInst.constrain(n,0,1);return r<1?this.pInst.lerpColor(t,e,r):this.pInst.lerpColor(e,t,this.pInst.map(r,1,2,0,1))}},{key:"get3CycleColor",value:function(t,e,n){var r=3*this.pInst.constrain(n,0,1);return r<1?this.pInst.lerpColor(t,e,r):r<2?this.pInst.lerpColor(e,t,this.pInst.map(r,1,2,1,0)):this.pInst.lerpColor(t,e,this.pInst.map(r,2,3,1,0))}},{key:"getPointHighlight",value:function(t){this.pInst.stroke(255,0,0)}},{key:"isMouseOver",value:function(){var t=this.getMouseCoords(),e=t.x,n=t.y,r=e-this.x,i=n-this.y,o=this.p0.x,s=this.p0.y,a=this.p1.x,u=this.p1.y;if(this.pInst.dist(o,s,a,u)<1e-6)return!1;var l=this.clamp(this.projectParam(r,i,o,s,a,u),0,1),h=this.pInst.lerp(o,a,l),c=this.pInst.lerp(s,u,l),f=Math.max(2,.6*this.lineW);return this.pInst.dist(r,i,h,c)<=f}},{key:"isMouseOverCallback",value:function(t){this.isMouseOver()&&t(this)}},{key:"selectPoints",value:function(){return this.p0.isMouseOver()?(this.p0.startDrag(),this.p0):this.p1.isMouseOver()?(this.p1.startDrag(),this.p1):null}},{key:"leftToRight",value:function(){if(this.p0.x>this.p1.x){var t=this.pInst.createVector(this.p0.x,this.p0.y);this.p0.set(this.p1),this.p1.set(t)}}},{key:"rightToLeft",value:function(){if(this.p0.x<this.p1.x){var t=this.pInst.createVector(this.p0.x,this.p0.y);this.p0.set(this.p1),this.p1.set(t)}}},{key:"displayNumber",value:function(){this.pInst.push(),this.pInst.noStroke(),this.pInst.fill(255);var t=(this.p0.x+this.p1.x)/2,e=(this.p0.y+this.p1.y)/2;this.pInst.text(this.id.toString(),this.x+t+10,this.y+e),this.pInst.pop()}},{key:"projectParam",value:function(t,e,n,r,i,o){var s=i-n,a=o-r,u=s*s+a*a;return u<=1e-12?0:((t-n)*s+(e-r)*a)/u}},{key:"clamp",value:function(t,e,n){return Math.max(e,Math.min(n,t))}},{key:"hashString",value:function(t){for(var e=2166136261,n=0;n<t.length;n++)e^=t.charCodeAt(n),e=Math.imul(e,16777619);return e>>>0}}],r&&Ut(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(y);function qt(t){return qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qt(t)}function Zt(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Kt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function Kt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function te(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ne(r.key),r)}}function ee(t,e,n){return(e=ne(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ne(t){var e=function(t){if("object"!=qt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=qt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==qt(e)?e:e+""}var re=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ee(this,"surfaces",[]),ee(this,"lines",[]),ee(this,"dragged",null),ee(this,"selected",null),ee(this,"pMousePressed",!1),ee(this,"moveMode","ALL"),ee(this,"calibrate",!1),ee(this,"pInst",null),ee(this,"bezShader",null),ee(this,"bezierShaderLoaded",!1)},e=[{key:"preload",value:function(t){this.bezShader=t,this.bezierShaderLoaded=!0}},{key:"init",value:function(t,e){if(!this.pInst)throw new Error("ProjectionMapper.init: pInst not set");this.buffer&&this.bezBuffer&&this.bufferWEBGL||(this.bufferWEBGL=this.pInst.createGraphics(t,e,this.pInst.WEBGL),this.buffer=this.pInst.createGraphics(t,e),this.bezBuffer=this.pInst.createGraphics(t,e),this.bezierShaderLoaded||this.initPMapperShaderStr())}},{key:"initPMapperShaderStr",value:function(){this.bezShader=this.bufferWEBGL.createShader("\n      #ifdef GL_ES\n      precision mediump float;\n      #endif\n      attribute vec3 aPosition;\n      attribute vec2 aTexCoord;\n      varying vec2 vTexCoord;\n      void main() {\n        vTexCoord = aTexCoord;\n        vec4 p = vec4(aPosition, 1.0);\n        p.xy = p.xy * 2.0 - 1.0;\n        gl_Position = p;\n      }","\n      #ifdef GL_ES\n      precision mediump float;\n      #endif\n      varying vec2 vTexCoord;\n      uniform sampler2D texMask;\n      uniform sampler2D texImg;\n      void main() {\n        vec2 uv = vTexCoord;\n        uv.y = 1.0 - uv.y;\n        vec4 maskT = texture2D(texMask, uv);\n        vec4 imgT = texture2D(texImg, uv);\n        float gray = (maskT.r + maskT.g + maskT.b) / 3.0;\n        vec3 thresh = imgT.rgb * gray;\n        gl_FragColor = vec4(thresh, gray);\n      }"),this.bezierShaderLoaded=!0}},{key:"createQuadMap",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;if(!this.pInst||!this.buffer)throw new Error("ProjectionMapper not initialized");var r=new at(this.surfaces.length,t,e,n,this.buffer,this.pInst);return this.surfaces.push(r),r}},{key:"createTriMap",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;if(!this.pInst||!this.buffer)throw new Error("ProjectionMapper not initialized");var r=new yt(this.surfaces.length,t,e,n,this.buffer,this.pInst);return this.surfaces.push(r),r}},{key:"createPolyMap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;if(!this.pInst||!this.buffer)throw new Error("ProjectionMapper not initialized");var e=Math.max(3,Math.floor(t)),n=new Pt(this.surfaces.length,e,this.buffer,this.pInst);return this.surfaces.push(n),n}},{key:"createBezierMap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;if(!this.pInst)throw new Error("ProjectionMapper not initialized");var e=new Wt(this.surfaces.length,t,this,this.pInst);return this.surfaces.push(e),e}},{key:"createLineMap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.pInst)throw new Error("ProjectionMapper not initialized");0===t&&0===e&&0===n&&0===r&&(n=200,e=30*this.lines.length,r=30*this.lines.length);var i=new $t(t,e,n,r,this.lines.length,this.pInst);return this.lines.push(i),i}},{key:"onClick",value:function(){this.calibrate&&("SURFACES"===this.moveMode?this.checkSurfacesClick():"POINTS"===this.moveMode?this.checkPointsClick():this.checkPointsClick()||this.checkSurfacesClick())}},{key:"moveSurfaces",value:function(){this.moveMode="SURFACES"}},{key:"moveControlPoints",value:function(){this.moveMode="POINTS"}},{key:"moveAll",value:function(){this.moveMode="ALL"}},{key:"isMovingPoints",value:function(){return"ALL"===this.moveMode||"POINTS"===this.moveMode}},{key:"checkSurfacesClick",value:function(){for(var t=this.lines.length-1;t>=0;t--){var e=this.lines[t];if(this.dragged=e.selectDraggable(),this.dragged)return!0}for(var n=this.surfaces.length-1;n>=0;n--){var r=this.surfaces[n];if(this.dragged=r.selectDraggable(),this.dragged)return this.selected=r,!0}return this.selected=null,!1}},{key:"checkPointsClick",value:function(){for(var t=this.lines.length-1;t>=0;t--){var e=this.lines[t];if(this.dragged=e.selectPoints(),this.dragged)return!0}for(var n=this.surfaces.length-1;n>=0;n--){var r=this.surfaces[n];if(this.dragged=r.selectPoints(),this.dragged)return this.selected=r,!0}return this.selected=null,!1}},{key:"onDrag",value:function(){this.dragged&&this.dragged.moveTo&&this.dragged.moveTo()}},{key:"onRelease",value:function(){this.dragged=null}},{key:"isDragging",value:function(t){return this.dragged===t}},{key:"updateEvents",value:function(){this.pInst&&(this.pInst.mouseIsPressed?this.pMousePressed?this.onDrag():this.onClick():this.pMousePressed&&this.onRelease(),this.pMousePressed=this.pInst.mouseIsPressed)}},{key:"load",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"maps/map.json",n=arguments.length>1?arguments[1]:void 0;if(!this.pInst)throw new Error("ProjectionMapper not initialized");this.pInst.loadJSON(e,function(e){t.loadedJson(e),n&&n()},function(t){return console.warn("error loading ".concat(e),t)})}},{key:"loadedJson",value:function(t){t.surfaces&&this.loadSurfaces(t.surfaces),t.lines&&this.loadLines(t.lines)}},{key:"loadSurfaces",value:function(t){var e=this;t.length!==this.surfaces.length&&console.warn("json has ".concat(t.length," surfaces but memory has ").concat(this.surfaces.length," surfaces"));var n=function(n){for(var r=function(e){return t.filter(function(t){return t.type===e})}(n),i=function(t){return e.surfaces.filter(function(e){return e.type===t})}(n),o=0;o<r.length&&o<i.length;){var s=i[o],a=r[o];s.isEqual({id:a.id,type:a.type})?s.load(a):console.warn("mismatch between calibration surface types/ids"),o++}};n("TRI"),n("QUAD"),n("BEZ"),n("POLY")}},{key:"loadLines",value:function(t){t.length!==this.lines.length&&console.warn("json has ".concat(t.length," lines but memory has ").concat(this.lines.length," lines"));for(var e=0;e<Math.min(t.length,this.lines.length);e++)this.lines[e].load(t[e])}},{key:"save",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"map.json";if(this.pInst){var e={surfaces:this.surfaces.map(function(t){return t.toJSON()}).filter(Boolean),lines:this.lines.map(function(t){return t.toJSON()})};this.pInst.saveJSON(e,t)}}},{key:"startCalibration",value:function(){this.calibrate=!0}},{key:"stopCalibration",value:function(){this.calibrate=!1}},{key:"toggleCalibration",value:function(){this.calibrate=!this.calibrate}},{key:"displayControlPoints",value:function(){if(this.calibrate){var t,e=Zt(this.surfaces);try{for(e.s();!(t=e.n()).done;){var n=t.value;n instanceof V&&n.displayControlPoints()}}catch(t){e.e(t)}finally{e.f()}var r,i=Zt(this.lines);try{for(i.s();!(r=i.n()).done;){var o=r.value;o.displayCalibration(),o.displayControlPoints()}}catch(t){i.e(t)}finally{i.f()}}}},{key:"getOscillator",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.pInst?function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t.constrain(e,.01,100);return.5+.5*t.sin(t.frameCount/(60*r)*2*t.PI+n)}(this.pInst,t,e):0}},{key:"getBezierShader",value:function(){return this.bezShader}}],e&&te(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}());p5.prototype.createProjectionMapper=function(t,e,n){var r=null!=e?e:t.width,i=null!=n?n:t.height;return re.pInst=t,re.init(r,i),re},p5.prototype.isCalibratingMapper=function(){return re.calibrate},p5.prototype.isMovingPoints=function(){return re.isMovingPoints()},p5.prototype.isDragging=function(t){return re.isDragging(t)},p5.prototype.initPMapperShader=function(){var t="https://cdn.statically.io/gh/jdeboi/p5.mapper/main/src/surfaces/Bezier/shader";this.loadShader(t+".vert",t+".frag",function(t){return re.preload(t)})},p5.prototype.registerMethod("post",function(){re.displayControlPoints(),re.updateEvents()});const ie=re;return e.default})());