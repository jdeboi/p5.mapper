!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["p5.mapper"]=e():t["p5.mapper"]=e()}(self,(function(){return(()=>{"use strict";var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);var n={dim:function(t){var r;return"object"===e(t)?"object"===e(r=t[0])?"object"===e(r[0])?n._dim(t):[t.length,r.length]:[t.length]:[]},_foreach2:function t(e,n,r,i){if(r===n.length-1)return i(e);var o,s=n[r],h=Array(s);for(o=s-1;o>=0;o--)h[o]=t(e[o],n,r+1,i);return h},cloneV:function(t){var e,n=t.length,r=Array(n);for(e=n-1;-1!==e;--e)r[e]=t[e];return r},clone:function(t){if("object"!==e(t))return t;var r=n.cloneV,i=n.dim(t);return n._foreach2(t,i,0,r)},diag:function(t){var e,n,r,i,o=t.length,s=Array(o);for(e=o-1;e>=0;e--){for(i=Array(o),n=e+2,r=o-1;r>=n;r-=2)i[r]=0,i[r-1]=0;for(r>e&&(i[r]=0),i[e]=t[e],r=e-1;r>=1;r-=2)i[r]=0,i[r-1]=0;0===r&&(i[0]=0),s[e]=i}return s},rep:function(t,e,r){void 0===r&&(r=0);var i,o=t[r],s=Array(o);if(r===t.length-1){for(i=o-2;i>=0;i-=2)s[i+1]=e,s[i]=e;return-1===i&&(s[0]=e),s}for(i=o-1;i>=0;i--)s[i]=n.rep(t,e,r+1);return s},identity:function(t){return n.diag(n.rep([t],1))},inv:function(t){var e,r,i,o,s,h,a,u,c=n.dim(t),l=Math.abs,f=c[0],y=c[1],p=n.clone(t),v=n.identity(f);for(h=0;h<y;++h){var d=-1,m=-1;for(s=h;s!==f;++s)(a=l(p[s][h]))>m&&(d=s,m=a);for(r=p[d],p[d]=p[h],p[h]=r,o=v[d],v[d]=v[h],v[h]=o,u=r[h],a=h;a!==y;++a)r[a]/=u;for(a=y-1;-1!==a;--a)o[a]/=u;for(s=f-1;-1!==s;--s)if(s!==h){for(e=p[s],i=v[s],u=e[h],a=h+1;a!==y;++a)e[a]-=r[a]*u;for(a=y-1;a>0;--a)i[a]-=o[a]*u,i[--a]-=o[a]*u;0===a&&(i[0]-=o[0]*u)}}return v},dotMMsmall:function(t,e){var n,r,i,o,s,h,a,u,c,l,f;for(o=t.length,s=e.length,h=e[0].length,a=Array(o),n=o-1;n>=0;n--){for(u=Array(h),c=t[n],i=h-1;i>=0;i--){for(l=c[s-1]*e[s-1][i],r=s-2;r>=1;r-=2)f=r-1,l+=c[r]*e[r][i]+c[f]*e[f][i];0===r&&(l+=c[0]*e[0][i]),u[i]=l}a[n]=u}return a},dotMV:function(t,e){var r,i=t.length,o=Array(i),s=n.dotVV;for(r=i-1;r>=0;r--)o[r]=s(t[r],e);return o},dotVV:function(t,e){var n,r,i=t.length,o=t[i-1]*e[i-1];for(n=i-2;n>=1;n-=2)r=n-1,o+=t[n]*e[n]+t[r]*e[r];return 0===n&&(o+=t[0]*e[0]),o},transpose:function(t){var e,n,r,i,o,s=t.length,h=t[0].length,a=Array(h);for(n=0;n<h;n++)a[n]=Array(s);for(e=s-1;e>=1;e-=2){for(i=t[e],r=t[e-1],n=h-1;n>=1;--n)(o=a[n])[e]=i[n],o[e-1]=r[n],(o=a[--n])[e]=i[n],o[e-1]=r[n];0===n&&((o=a[0])[e]=i[0],o[e-1]=r[0])}if(0===e){for(r=t[0],n=h-1;n>=1;--n)a[n][0]=r[n],a[--n][0]=r[n];0===n&&(a[0][0]=r[0])}return a}};const r=n;function i(t,e,n){if(n){var i=e;e=t,t=i}var o,s=[[t[0],t[1],1,0,0,0,-1*e[0]*t[0],-1*e[0]*t[1]],[0,0,0,t[0],t[1],1,-1*e[1]*t[0],-1*e[1]*t[1]],[t[2],t[3],1,0,0,0,-1*e[2]*t[2],-1*e[2]*t[3]],[0,0,0,t[2],t[3],1,-1*e[3]*t[2],-1*e[3]*t[3]],[t[4],t[5],1,0,0,0,-1*e[4]*t[4],-1*e[4]*t[5]],[0,0,0,t[4],t[5],1,-1*e[5]*t[4],-1*e[5]*t[5]],[t[6],t[7],1,0,0,0,-1*e[6]*t[6],-1*e[6]*t[7]],[0,0,0,t[6],t[7],1,-1*e[7]*t[6],-1*e[7]*t[7]]],h=e;try{o=r.inv(r.dotMMsmall(r.transpose(s),s))}catch(t){return console.log(t),[1,0,0,0,1,0,0,0]}for(var a,u=r.dotMMsmall(o,r.transpose(s)),c=r.dotMV(u,h),l=0;l<c.length;l++)c[l]=(a=c[l],Math.round(1e10*a)/1e10);return c[8]=1,c}function o(t,e){return"undefined"!=typeof window&&window===this||void 0===this?new o(t,e):(this.srcPts=t,this.dstPts=e,this.coeffs=i(this.srcPts,this.dstPts,!1),this.coeffsInv=i(this.srcPts,this.dstPts,!0),this)}o.prototype={transform:function(t,e){var n=[];return n[0]=(this.coeffs[0]*t+this.coeffs[1]*e+this.coeffs[2])/(this.coeffs[6]*t+this.coeffs[7]*e+1),n[1]=(this.coeffs[3]*t+this.coeffs[4]*e+this.coeffs[5])/(this.coeffs[6]*t+this.coeffs[7]*e+1),n},transformInverse:function(t,e){var n=[];return n[0]=(this.coeffsInv[0]*t+this.coeffsInv[1]*e+this.coeffsInv[2])/(this.coeffsInv[6]*t+this.coeffsInv[7]*e+1),n[1]=(this.coeffsInv[3]*t+this.coeffsInv[4]*e+this.coeffsInv[5])/(this.coeffsInv[6]*t+this.coeffsInv[7]*e+1),n}};const s=o;function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const a=function(){function t(e,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=n,this.y=r,this.r=i,this.isControlPoint=!1,this.parent=e}var e,n;return e=t,(n=[{key:"set",value:function(t){this.x=t.x,this.y=t.y}},{key:"moveTo",value:function(t,e){this.x=t,this.y=e}},{key:"setControlPoint",value:function(t){this.isControlPoint=t}},{key:"interpolateBetween",value:function(t,e,n){this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n}}])&&h(e.prototype,n),t}();function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e,n){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},l(t,e,n||t)}function f(t,e){return f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},f(t,e)}function y(t,e){if(e&&("object"===u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}const v=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(s,t);var e,n,r,i,o=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=p(r);if(i){var n=p(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return y(this,t)});function s(t,e,n,r,i){var h;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(h=o.call(this,t,e,n,30)).u=r,h.v=i,h}return e=s,(n=[{key:"set",value:function(t){l(p(s.prototype),"set",this).call(this,t),this.u=t.u,this.v=t.v}},{key:"moveTo",value:function(t,e){this.x=t-this.parent.x,this.y=e-this.parent.y,this.parent.calculateMesh()}},{key:"interpolateTo",value:function(t,e){var n=this.x+(t.x-this.x)*e,r=this.y+(t.y-this.y)*e;return new s(this.parent,n,r,0,0)}}])&&c(e.prototype,n),s}(a);var d=function t(e,n,r,i,o,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),p5.Graphics.call(this,n,r,WEBGL,s),this.id=e,this.res=Math.floor(i),this.type=o,this.x=0,this.y=0,this.clickX=0,this.clickY=0,this.gridColor=color(200),this.controlPointColor=color(255,0,255)};function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function x(t,e){return x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},x(t,e)}function k(t,e){if(e&&("object"===m(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function w(t){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},w(t)}d.prototype=Object.create(p5.Graphics.prototype);const P=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(s,t);var e,n,r,i,o=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=w(r);if(i){var n=w(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return k(this,t)});function s(t,e,n,r,i,h){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(a=o.call(this,t,e,n,r,i,h)).perspT=null,a.initMesh(),a.calculateMesh(),a}return e=s,(n=[{key:"beginDrawing",value:function(){this.push()}},{key:"endDrawing",value:function(){this.pop()}},{key:"initMesh",value:function(){this.mesh=[];for(var t=0;t<this.res;t++)for(var e=0;e<this.res;e++){var n=Math.floor(map(e,0,this.res,0,this.width)),r=Math.floor(map(t,0,this.res,0,this.height)),i=map(e,0,this.res,0,1),o=map(t,0,this.res,0,1);this.mesh[t*this.res+e]=new v(this,n,r,i,o)}this.TL=0,this.TR=this.res-1+0,this.BL=0+(this.res-1)*this.res,this.BR=this.res-1+(this.res-1)*this.res,this.mesh[this.TL].setControlPoint(!0),this.mesh[this.TR].setControlPoint(!0),this.mesh[this.BL].setControlPoint(!0),this.mesh[this.BR].setControlPoint(!0)}},{key:"load",value:function(t){var e=t.x,n=t.y,r=t.points;this.x=e,this.y=n;var i,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,h=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){h=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(h)throw o}}}}(r);try{for(o.s();!(i=o.n()).done;){var s=i.value,h=this.mesh[s.i];h.x=s.x,h.y=s.y,h.u=s.u,h.v=s.v,h.setControlPoint(!0)}}catch(t){o.e(t)}finally{o.f()}this.calculateMesh()}},{key:"getJson",value:function(){var t={};t.id=this.id,t.res=this.res,t.x=this.x,t.y=this.y,t.w=this.w,t.h=this.h,t.type=this.type,t.points=[];for(var e=0;e<this.mesh.length;e++)if(this.mesh[e].isControlPoint){var n={};n.i=e,n.x=this.mesh[e].x,n.y=this.mesh[e].y,n.u=this.mesh[e].u,n.v=this.mesh[e].v,t.points.push(n)}return t}},{key:"isEqual",value:function(t){return t.id===this.id&&t.type===this.type}},{key:"render",value:function(){}},{key:"isMouseOver",value:function(){}},{key:"getControlPoints",value:function(){return[]}},{key:"calculateMesh",value:function(){}},{key:"moveMeshPointBy",value:function(t,e,n){this.mesh[t].moveTo(this.mesh[t].x+e,this.mesh[t].y+n)}},{key:"displayControlPoints",value:function(){push(),translate(this.x,this.y),strokeWeight(2),stroke(this.controlPointColor),noFill();for(var t=this.getControlPoints(),e=0;e<t.length;e++){var n=t[e];ellipse(n.x,n.y,n.r),ellipse(n.x,n.y,n.r/2)}pop()}},{key:"getTransformedCursor",value:function(t,e){var n=this.perspT(t-this.x,e-this.y);return createVector(n[0],n[1])}},{key:"getTransformedMouse",value:function(){return getTransformedCursor(mouseX,mouseY)}},{key:"cross2",value:function(t,e,n,r){return t*r-e*n}},{key:"setGridColor",value:function(t){gridColor=t}},{key:"setControlPointsColor",value:function(t){controlPointColor=t}},{key:"select",value:function(){var t=mouseX-width/2,e=mouseY-height/2;t-=this.x,e-=this.y;for(var n=0;n<this.mesh.length;n++)if(dist(this.mesh[n].x,this.mesh[n].y,t,e)<this.mesh[n].r&&this.mesh[n].isControlPoint)return this.mesh[n];return this.isMouseOver()?(this.clickX=t,this.clickY=e,this):null}},{key:"isPointInTriangle",value:function(t,e,n,r,i){var o=createVector(i.x-n.x,i.y-n.y),s=createVector(r.x-n.x,r.y-n.y),h=createVector(t-n.x,e-n.y),a=o.dot(o),u=s.dot(o),c=h.dot(o),l=s.dot(s),f=h.dot(s),y=1/(a*l-u*u),p=(l*c-u*f)*y,v=(a*f-u*c)*y;return p>0&&v>0&&p+v<1}},{key:"moveTo",value:function(t,e){this.x=t-this.clickX,this.y=e-this.clickY}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}}])&&b(e.prototype,n),s}(d);function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function O(t,e){return O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},O(t,e)}function S(t,e){if(e&&("object"===C(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function j(t){return j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},j(t)}var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(h,t);var e,n,r,i,o=(r=h,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=j(r);if(i){var n=j(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return S(this,t)});function h(t,e,n,r,i){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),o.call(this,t,e,n,r,"QUAD",i)}return e=h,n=[{key:"isMouseOver",value:function(){var t=mouseX-width/2,e=mouseY-height/2;return!(!this.isPointInTriangle(t-this.x,e-this.y,this.mesh[this.TL],this.mesh[this.TR],this.mesh[this.BL])&&!this.isPointInTriangle(t-this.x,e-this.y,this.mesh[this.BL],this.mesh[this.TR],this.mesh[this.BR]))}},{key:"calculateMesh",value:function(){var t=[0,0,this.width,0,this.width,this.height,0,this.height],e=[this.mesh[this.TL].x,this.mesh[this.TL].y,this.mesh[this.TR].x,this.mesh[this.TR].y,this.mesh[this.BR].x,this.mesh[this.BR].y,this.mesh[this.BL].x,this.mesh[this.BL].y];this.perspT=s(t,e);for(var n=this.width/(this.res-1),r=this.height/(this.res-1),i=0;i<this.mesh.length;i++)if(this.TL!=i&&this.BR!=i&&this.TR!=i&&this.BL!=i){var o=i%this.res,h=Math.floor(i/this.res);o*=n,h*=r;var a=this.perspT.transform(o,h);this.mesh[i].x=a[0],this.mesh[i].y=a[1]}}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.width,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.height;push(),translate(this.x,this.y),stroke(255,0,255),strokeWeight(3),fill(0,255,0),texture(this),beginShape(TRIANGLES);for(var i=0;i<this.res-1;i++)for(var o=0;o<this.res-1;o++)this.getQuadTriangles(i,o,t,e,n,r);endShape(CLOSE),pop()}},{key:"getQuadTriangles",value:function(t,e,n,r,i,o){var s=this.mesh[t+e*this.res];this.getVertexUV(s,n,r,i,o),s=this.mesh[t+1+e*this.res],this.getVertexUV(s,n,r,i,o),s=this.mesh[t+1+(e+1)*this.res],this.getVertexUV(s,n,r,i,o),this.getVertexUV(s,n,r,i,o),s=this.mesh[t+(e+1)*this.res],this.getVertexUV(s,n,r,i,o),s=this.mesh[t+e*this.res],this.getVertexUV(s,n,r,i,o)}},{key:"getVertexUV",value:function(t,e,n,r,i){var o=map(t.u,0,1,e,e+r),s=map(t.v,0,1,n,n+i);vertex(t.x,t.y,o,s)}},{key:"getControlPoints",value:function(){return[this.mesh[this.TL],this.mesh[this.TR],this.mesh[this.BR],this.mesh[this.BL]]}}],n&&T(e.prototype,n),h}(P);const M=R;function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function V(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _(t,e){return _=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_(t,e)}function E(t,e){if(e&&("object"===B(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function L(t){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},L(t)}const I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(s,t);var e,n,r,i,o=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=L(r);if(i){var n=L(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return E(this,t)});function s(t,e,n,r,i){var h;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(h=o.call(this,t,e,n,r,"TRI",i)).setTriMesh(),h}return e=s,(n=[{key:"isMouseOver",value:function(){var t=mouseX-width/2,e=mouseY-height/2;return!!this.isPointInTriangle(t-this.x,e-this.y,this.mesh[this.TP],this.mesh[this.BL],this.mesh[this.BR])}},{key:"Barycentric",value:function(t,e,n,r,i,o,s){var h=n.sub(e),a=r.sub(e),u=t.sub(e);h.dot(h),h.dot(a),a.dot(a),u.dot(h),u.dot(a)}},{key:"setTriMesh",value:function(){this.TP=Math.floor(this.res/2)-1,this.mesh[this.TP].setControlPoint(!0),this.mesh[this.TL].setControlPoint(!1),this.mesh[this.TR].setControlPoint(!1)}},{key:"render",value:function(){push(),translate(this.x,this.y),noStroke(),fill(0),texture(this),beginShape();var t=0,e=this.height;vertex(this.mesh[this.BL].x,this.mesh[this.BL].y,t,e),t=this.width/2,e=0,vertex(this.mesh[this.TP].x,this.mesh[this.TP].y,t,e),t=this.width,e=this.height,vertex(this.mesh[this.BR].x,this.mesh[this.BR].y,t,e),endShape(CLOSE),pop()}},{key:"getP1",value:function(){return createVector(this.mesh[this.TP].x,mesh[this.TP].y)}},{key:"getP2",value:function(){return createVector(this.mesh[this.BL].x,mesh[this.BL].y)}},{key:"getP3",value:function(){return createVector(this.mesh[this.BR].x,mesh[this.BR].y)}},{key:"getControlPoints",value:function(){return[this.mesh[this.TP],this.mesh[this.BL],this.mesh[this.BR]]}}])&&V(e.prototype,n),s}(P);function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var W=function(){function t(e,n,r,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=o,this.p0=new a(this,e,n,20),this.p1=new a(this,r,i,20),this.lineW=10,this.lastChecked=0,this.lineC=color(255),this.highlightColor=color(0,255,0),this.leftToRight(),this.ang=atan2(this.p0.y-this.p1.y,this.p0.x-this.p1.x),this.ang>PI/2&&(this.ang-=2*PI)}var e,n;return e=t,n=[{key:"load",value:function(t){this.p0.x=t.x0,this.p0.y=t.y0,this.p1.x=t.x1,this.p1.y=t.y1}},{key:"getJson",value:function(){var t={};return t.id=this.id,t.x0=this.p0.x,t.y0=this.p0.y,t.x1=this.p1.x,t.y1=this.p1.y,t}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.lineC;strokeWeight(this.lineW),stroke(t),line(this.p0.x,this.p0.y,this.p1.x,this.p1.y),this.drawEndCaps(this.p0,this.p1,t,t)}},{key:"displayCenterPulse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineC;t=constrain(t,0,1);var n=(this.p0.x+this.p1.x)/2,r=(this.p0.y+this.p1.y)/2,i=map(t,0,1,n,this.p0.x),o=map(t,0,1,n,this.p1.x),s=map(t,0,1,r,this.p0.y),h=map(t,0,1,r,this.p1.y);strokeWeight(this.lineW),stroke(e),line(i,s,o,h),this.drawEndCaps({x:i,y:s},{x:o,y:h},e,e)}},{key:"displayPercent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineC;t=constrain(t,0,1),t*=2;var n=constrain(t,0,1),r=createVector(this.p0.x,this.p0.y),i=createVector(this.p1.x,this.p1.y),o=p5.Vector.lerp(r,i,n);strokeWeight(this.lineW),stroke(e),line(this.p0.x,this.p0.y,o.x,o.y),this.drawEndCaps(r,o,e,e)}},{key:"displayPercentWidth",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lineC;t=constrain(t,0,1);var n=map(t,0,1,0,10);strokeWeight(n),stroke(e),line(this.p0.x,this.p0.y,this.p1.x,this.p1.y),this.drawEndCaps(p0,p1,e,e)}},{key:"displayNone",value:function(){this.display(color(0))}},{key:"displayRainbowCycle",value:function(){colorMode(HSB,255);var t=color(frameCount%255,255,255);this.display(t),colorMode(RGB,255)}},{key:"displayGradientLine",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n+=r,n%=1;for(var i=1/height,o=0;o<1;o+=i){var s=(o/2+n)%1,h=this.get2CycleColor(t,e,s);this.displaySegment(o,i,h)}}},{key:"displayControlPoints",value:function(){push(),noFill(),strokeWeight(2),translate(0,0,.5),this.getPointHighlight(this.p0),ellipse(this.p0.x,this.p0.y,20),this.getPointHighlight(this.p1),ellipse(this.p1.x,this.p1.y,20),pop()}},{key:"drawEndCaps",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.lineC,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.lineC;noStroke(),dist(t.x,t.y,e.x,e.y)>1&&(fill(n),ellipse(t.x,t.y,this.lineW,this.lineW),fill(r),ellipse(e.x,e.y,this.lineW,this.lineW))}},{key:"displaySegment",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.lineC;strokeWeight(this.lineW),stroke(n);var r=createVector(this.p0.x,this.p0.y),i=createVector(this.p1.x,this.p1.y),o=p5.Vector.lerp(r,i,t),s=p5.Vector.lerp(o,i,t+e);line(o.x,o.y,s.x,s.y),this.drawEndCaps(o,s,n,n)}},{key:"get2CycleColor",value:function(t,e,n){return n=constrain(n,0,1),(n*=2)<1?lerpColor(t,e,n):(n=map(n,1,2,0,1),lerpColor(e,t,n))}},{key:"get3CycleColor",value:function(t,e,n){return n=constrain(n,0,1),(n*=3)<1?lerpColor(t,e,n):n<2?(n=map(n,1,2,1,0),lerpColor(c3,e,n)):(n=map(n,2,3,1,0),lerpColor(t,c3,n))}},{key:"getPointHighlight",value:function(t){colorMode(RGB,255),this.isMouseOverPoint(t)?stroke(0,255,0):stroke(255,0,0)}},{key:"isMouseOverPoint",value:function(t){return dist(t.x,t.y,mouseX-width/2,mouseY-height/2)<t.r}},{key:"isMouseOver",value:function(){var t=this.p0.x,e=this.p0.y,n=this.p1.x,r=this.p1.y,i=mouseX-width/2,o=mouseY-height/2,s=dist(i,o,t,e),h=dist(i,o,n,r),a=dist(t,e,n,r);return s+h>=a-.2&&s+h<=a+.2}},{key:"select",value:function(){var t=mouseX-width/2,e=mouseY-height/2;return dist(this.p0.x,this.p0.y,t,e)<this.p0.r?this.p0:dist(this.p1.x,this.p1.y,t,e)<this.p1.r?this.p1:null}},{key:"leftToRight",value:function(){if(this.p0.x>this.p1.x){var t=createVector(this.p0.x,this.p0.y);this.p0.set(this.p1),this.p1.set(t)}}},{key:"rightToLeft",value:function(){if(this.p0.x<this.p1.x){var t=createVector(this.p0.x,this.p0.y);this.p0.set(this.p1),this.p1.set(t)}}}],n&&A(e.prototype,n),t}();const D=W;function X(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Y(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,h=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){h=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(h)throw o}}}}function Y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function U(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var G=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.surfaces=[],this.lines=[],this.dragged=null,this.calibrate=!1}var e,n;return e=t,n=[{key:"createQuadMap",value:function(t,e,n,r){var i=new M(this.surfaces.length,t,e,n,r);return this.surfaces.push(i),i}},{key:"createTriMap",value:function(t,e,n,r){var i=new I(this.surfaces.length,t,e,n,r);return this.surfaces.push(i),i}},{key:"createLineMap",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=new D(t,e,n,r,this.lines.length);return this.lines.push(i),i}},{key:"renderSurfaces",value:function(){var t,e=X(this.surfaces);try{for(e.s();!(t=e.n()).done;)t.value.render()}catch(t){e.e(t)}finally{e.f()}}},{key:"onClick",value:function(){if(this.calibrate){for(var t=this.lines.length-1;t>=0;t--){var e=this.lines[t];if(this.dragged=e.select(),null!=this.dragged)break}for(var n=this.surfaces.length-1;n>=0;n--){var r=this.surfaces[n];if(this.dragged=r.select(),null!=this.dragged)break}}}},{key:"onDrag",value:function(){var t=mouseX-width/2,e=mouseY-height/2;null!=this.dragged&&this.dragged.moveTo(t,e)}},{key:"onRelease",value:function(){this.dragged=null}},{key:"load",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"maps/map.json";console.log("loading json file: ".concat(t));var e=this,n=function(e){return console.log("error loading ".concat(t),e)};loadJSON("".concat(t),e.loadedJson.bind(e),n)}},{key:"loadedJson",value:function(t){var e=t.surfaces;e.length!==this.surfaces.length&&console.warn("json calibration file has ".concat(e.length," surface maps but there are ").concat(this.surfaces.length," surface maps in memory (check sketch.js for # of map objects)"));for(var n=0;n<e.length&&n<this.surfaces.length;){var r=this.surfaces[n];r.isEqual(this.surfaces[n])?r.load(e[n]):console.warn("mismatch between calibration surface types / ids"),n++}var i=t.lines;for(i.length!==this.lines.length&&console.warn("json calibration file has ".concat(i.length," line maps but there are only ").concat(this.lines.length," line maps in memory")),n=0;n<i.length&&n<this.lines.length;)this.lines[n].load(i[n]),n++}},{key:"save",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"map.json";console.log("saving all mapped surfaces to json...");var e,n={surfaces:[],lines:[]},r=X(this.surfaces);try{for(r.s();!(e=r.n()).done;){var i=e.value;n.surfaces.push(i.getJson())}}catch(t){r.e(t)}finally{r.f()}var o,s=X(this.lines);try{for(s.s();!(o=s.n()).done;){var h=o.value;n.lines.push(h.getJson())}}catch(t){s.e(t)}finally{s.f()}saveJSON(n,"".concat(t))}},{key:"startCalibration",value:function(){this.calibrate=!0}},{key:"stopCalibration",value:function(){this.calibrate=!1}},{key:"toggleCalibration",value:function(){this.calibrate=!this.calibrate}},{key:"beginSurfaces",value:function(){var t,e=X(this.surfaces);try{for(e.s();!(t=e.n()).done;)t.value.beginDrawing()}catch(t){e.e(t)}finally{e.f()}}},{key:"endSurfaces",value:function(){var t,e=X(this.surfaces);try{for(e.s();!(t=e.n()).done;)t.value.endDrawing()}catch(t){e.e(t)}finally{e.f()}}},{key:"displayControlPoints",value:function(){if(this.calibrate){var t,e=X(this.surfaces);try{for(e.s();!(t=e.n()).done;)t.value.displayControlPoints()}catch(t){e.e(t)}finally{e.f()}var n,r=X(this.lines);try{for(r.s();!(n=r.n()).done;)n.value.displayControlPoints()}catch(t){r.e(t)}finally{r.f()}}}}],n&&U(e.prototype,n),t}(),J=new G;return p5.prototype.createProjectionMapper=function(){return J},p5.prototype.isCalibratingMapper=function(){return J.calibrate},p5.prototype.beginSurfaces=function(){J.beginSurfaces()},p5.prototype.renderSurfaces=function(){J.endSurfaces(),J.renderSurfaces(),J.displayControlPoints()},p5.prototype.registerMethod("pre",p5.prototype.beginSurfaces),p5.prototype.registerMethod("post",p5.prototype.renderSurfaces),t})()}));