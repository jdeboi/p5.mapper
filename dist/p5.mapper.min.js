!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["p5.mapper"]=e():t["p5.mapper"]=e()}(self,(function(){return(()=>{"use strict";var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);var r={dim:function(t){var n;return"object"===e(t)?"object"===e(n=t[0])?"object"===e(n[0])?r._dim(t):[t.length,n.length]:[t.length]:[]},_foreach2:function t(e,r,n,o){if(n===r.length-1)return o(e);var i,s=r[n],u=Array(s);for(i=s-1;i>=0;i--)u[i]=t(e[i],r,n+1,o);return u},cloneV:function(t){var e,r=t.length,n=Array(r);for(e=r-1;-1!==e;--e)n[e]=t[e];return n},clone:function(t){if("object"!==e(t))return t;var n=r.cloneV,o=r.dim(t);return r._foreach2(t,o,0,n)},diag:function(t){var e,r,n,o,i=t.length,s=Array(i);for(e=i-1;e>=0;e--){for(o=Array(i),r=e+2,n=i-1;n>=r;n-=2)o[n]=0,o[n-1]=0;for(n>e&&(o[n]=0),o[e]=t[e],n=e-1;n>=1;n-=2)o[n]=0,o[n-1]=0;0===n&&(o[0]=0),s[e]=o}return s},rep:function(t,e,n){void 0===n&&(n=0);var o,i=t[n],s=Array(i);if(n===t.length-1){for(o=i-2;o>=0;o-=2)s[o+1]=e,s[o]=e;return-1===o&&(s[0]=e),s}for(o=i-1;o>=0;o--)s[o]=r.rep(t,e,n+1);return s},identity:function(t){return r.diag(r.rep([t],1))},inv:function(t){var e,n,o,i,s,u,h,a,f=r.dim(t),c=Math.abs,l=f[0],y=f[1],v=r.clone(t),p=r.identity(l);for(u=0;u<y;++u){var m=-1,d=-1;for(s=u;s!==l;++s)(h=c(v[s][u]))>d&&(m=s,d=h);for(n=v[m],v[m]=v[u],v[u]=n,i=p[m],p[m]=p[u],p[u]=i,a=n[u],h=u;h!==y;++h)n[h]/=a;for(h=y-1;-1!==h;--h)i[h]/=a;for(s=l-1;-1!==s;--s)if(s!==u){for(e=v[s],o=p[s],a=e[u],h=u+1;h!==y;++h)e[h]-=n[h]*a;for(h=y-1;h>0;--h)o[h]-=i[h]*a,o[--h]-=i[h]*a;0===h&&(o[0]-=i[0]*a)}}return p},dotMMsmall:function(t,e){var r,n,o,i,s,u,h,a,f,c,l;for(i=t.length,s=e.length,u=e[0].length,h=Array(i),r=i-1;r>=0;r--){for(a=Array(u),f=t[r],o=u-1;o>=0;o--){for(c=f[s-1]*e[s-1][o],n=s-2;n>=1;n-=2)l=n-1,c+=f[n]*e[n][o]+f[l]*e[l][o];0===n&&(c+=f[0]*e[0][o]),a[o]=c}h[r]=a}return h},dotMV:function(t,e){var n,o=t.length,i=Array(o),s=r.dotVV;for(n=o-1;n>=0;n--)i[n]=s(t[n],e);return i},dotVV:function(t,e){var r,n,o=t.length,i=t[o-1]*e[o-1];for(r=o-2;r>=1;r-=2)n=r-1,i+=t[r]*e[r]+t[n]*e[n];return 0===r&&(i+=t[0]*e[0]),i},transpose:function(t){var e,r,n,o,i,s=t.length,u=t[0].length,h=Array(u);for(r=0;r<u;r++)h[r]=Array(s);for(e=s-1;e>=1;e-=2){for(o=t[e],n=t[e-1],r=u-1;r>=1;--r)(i=h[r])[e]=o[r],i[e-1]=n[r],(i=h[--r])[e]=o[r],i[e-1]=n[r];0===r&&((i=h[0])[e]=o[0],i[e-1]=n[0])}if(0===e){for(n=t[0],r=u-1;r>=1;--r)h[r][0]=n[r],h[--r][0]=n[r];0===r&&(h[0][0]=n[0])}return h}};const n=r;function o(t,e,r){if(r){var o=e;e=t,t=o}var i,s=[[t[0],t[1],1,0,0,0,-1*e[0]*t[0],-1*e[0]*t[1]],[0,0,0,t[0],t[1],1,-1*e[1]*t[0],-1*e[1]*t[1]],[t[2],t[3],1,0,0,0,-1*e[2]*t[2],-1*e[2]*t[3]],[0,0,0,t[2],t[3],1,-1*e[3]*t[2],-1*e[3]*t[3]],[t[4],t[5],1,0,0,0,-1*e[4]*t[4],-1*e[4]*t[5]],[0,0,0,t[4],t[5],1,-1*e[5]*t[4],-1*e[5]*t[5]],[t[6],t[7],1,0,0,0,-1*e[6]*t[6],-1*e[6]*t[7]],[0,0,0,t[6],t[7],1,-1*e[7]*t[6],-1*e[7]*t[7]]],u=e;try{i=n.inv(n.dotMMsmall(n.transpose(s),s))}catch(t){return console.log(t),[1,0,0,0,1,0,0,0]}for(var h,a=n.dotMMsmall(i,n.transpose(s)),f=n.dotMV(a,u),c=0;c<f.length;c++)f[c]=(h=f[c],Math.round(1e10*h)/1e10);return f[8]=1,f}function i(t,e){return"undefined"!=typeof window&&window===this||void 0===this?new i(t,e):(this.srcPts=t,this.dstPts=e,this.coeffs=o(this.srcPts,this.dstPts,!1),this.coeffsInv=o(this.srcPts,this.dstPts,!0),this)}i.prototype={transform:function(t,e){var r=[];return r[0]=(this.coeffs[0]*t+this.coeffs[1]*e+this.coeffs[2])/(this.coeffs[6]*t+this.coeffs[7]*e+1),r[1]=(this.coeffs[3]*t+this.coeffs[4]*e+this.coeffs[5])/(this.coeffs[6]*t+this.coeffs[7]*e+1),r},transformInverse:function(t,e){var r=[];return r[0]=(this.coeffsInv[0]*t+this.coeffsInv[1]*e+this.coeffsInv[2])/(this.coeffsInv[6]*t+this.coeffsInv[7]*e+1),r[1]=(this.coeffsInv[3]*t+this.coeffsInv[4]*e+this.coeffsInv[5])/(this.coeffsInv[6]*t+this.coeffsInv[7]*e+1),r}};const s=i;function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const h=function(){function t(e,r,n,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=r,this.y=n,this.u=o,this.v=i,this.isControlPoint=!1,this.parent=e}var e,r;return e=t,(r=[{key:"isControlPoint",value:function(){return this.isControlPoint}},{key:"moveTo",value:function(t,e){this.x=t-this.parent.x,this.y=e-this.parent.y,this.parent.calculateMesh()}},{key:"setControlPoint",value:function(t){this.isControlPoint=t}},{key:"interpolateTo",value:function(e,r){var n=this.x+(e.x-this.x)*r,o=this.y+(e.y-this.y)*r;return new t(this.parent,n,o,0,0)}},{key:"interpolateBetween",value:function(t,e,r){this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r}}])&&u(e.prototype,r),t}();function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const l=function(){function t(e,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.w=e,this.h=r,this.res=Math.floor(n),this.type=o,this.x=0,this.y=0,this.clickX=0,this.clickY=0,this.gridColor=color(200),this.controlPointColor=color(255,0,255),this.surface=createGraphics(e,r,WEBGL),this.perspT=null,this.initMesh(),this.calculateMesh()}var e,r;return e=t,(r=[{key:"initMesh",value:function(){this.mesh=[];for(var t=0;t<this.res;t++)for(var e=0;e<this.res;e++){var r=Math.floor(map(e,0,this.res,0,this.w)),n=Math.floor(map(t,0,this.res,0,this.h)),o=map(e,0,this.res,0,1),i=map(t,0,this.res,0,1);this.mesh[t*this.res+e]=new h(this,r,n,o,i)}this.TL=0,this.TR=this.res-1+0,this.BL=0+(this.res-1)*this.res,this.BR=this.res-1+(this.res-1)*this.res,this.mesh[this.TL].setControlPoint(!0),this.mesh[this.TR].setControlPoint(!0),this.mesh[this.BL].setControlPoint(!0),this.mesh[this.BR].setControlPoint(!0)}},{key:"load",value:function(t,e,r){this.x=t,this.y=e;var n,o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,i=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw i}}}}(r);try{for(o.s();!(n=o.n()).done;){var i=n.value,s=this.mesh[i.i];s.x=i.x,s.y=i.y,s.u=i.u,s.v=i.v,s.setControlPoint(!0)}}catch(t){o.e(t)}finally{o.f()}this.calculateMesh()}},{key:"calculateMesh",value:function(){}},{key:"beginDraw",value:function(){this.surface.push(),this.surface.clear(),this.surface.translate(-this.w/2,-this.h/2)}},{key:"background",value:function(t,e,r){var n=this.getColor(t,e,r);this.surface.fill(n),this.surface.noStroke(),this.surface.rect(0,0,this.w,this.h)}},{key:"endDraw",value:function(){this.surface.pop()}},{key:"fill",value:function(t,e,r){this.surface.fill(this.getColor(t,e,r))}},{key:"noFill",value:function(){this.surface.noFill()}},{key:"stroke",value:function(t,e,r){this.surface.stroke(this.getColor(t,e,r))}},{key:"noStroke",value:function(){this.surface.noStroke()}},{key:"strokeWeight",value:function(t){this.surface.strokeWeight(t)}},{key:"getColor",value:function(t,e,r){return"object"===a(t)?t:void 0!==e&&void 0!==r?color(t,e,r):color(t)}},{key:"rect",value:function(t,e,r,n){this.surface.rect(t,e,r,n)}},{key:"ellipse",value:function(t,e,r,n){this.surface.ellipse(t,e,r,n)}},{key:"line",value:function(t,e,r,n){this.surface.line(t,e,r,n)}},{key:"moveMeshPointBy",value:function(t,e,r){this.mesh[t].moveTo(this.mesh[t].x+e,this.mesh[t].y+r)}},{key:"getRes",value:function(){return this.res-1}},{key:"renderControlPoints",value:function(){strokeWeight(2),stroke(this.controlPointColor),noFill();for(var t=0;t<this.mesh.length;t++)this.mesh[t].isControlPoint&&(ellipse(this.mesh[t].x,this.mesh[t].y,30,30),ellipse(this.mesh[t].x,this.mesh[t].y,10,10))}},{key:"getTransformedCursor",value:function(t,e){var r=this.perspT(t-this.x,e-this.y);return createVector(r[0],r[1])}},{key:"getTransformedMouse",value:function(){return getTransformedCursor(mouseX,mouseY)}},{key:"cross2",value:function(t,e,r,n){return t*n-e*r}},{key:"setGridColor",value:function(t){gridColor=t}},{key:"setControlPointsColor",value:function(t){controlPointColor=t}},{key:"select",value:function(){var t=mouseX-width/2,e=mouseY-height/2;t-=this.x,e-=this.y;for(var r=0;r<this.mesh.length;r++)if(dist(this.mesh[r].x,this.mesh[r].y,t,e)<30&&this.mesh[r].isControlPoint)return this.mesh[r];return this.isMouseOver()?(this.clickX=t,this.clickY=e,this):null}},{key:"isPointInTriangle",value:function(t,e,r,n,o){var i=createVector(o.x-r.x,o.y-r.y),s=createVector(n.x-r.x,n.y-r.y),u=createVector(t-r.x,e-r.y),h=i.dot(i),a=s.dot(i),f=u.dot(i),c=s.dot(s),l=u.dot(s),y=1/(h*c-a*a),v=(c*f-a*l)*y,p=(h*l-a*f)*y;return v>0&&p>0&&v+p<1}},{key:"moveTo",value:function(t,e){this.x=t-this.clickX,this.y=e-this.clickY}},{key:"getWidth",value:function(){return this.w}},{key:"getHeight",value:function(){return this.h}}])&&c(e.prototype,r),t}();function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function v(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e){return p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},p(t,e)}function m(t,e){if(e&&("object"===y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(u,t);var e,r,n,o,i=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=d(n);if(o){var r=d(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return m(this,t)});function u(t,e,r){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),i.call(this,t,e,r,"QUAD")}return e=u,r=[{key:"isMouseOver",value:function(){var t=mouseX-width/2,e=mouseY-height/2;return!(!this.isPointInTriangle(t-this.x,e-this.y,this.mesh[this.TL],this.mesh[this.TR],this.mesh[this.BL])&&!this.isPointInTriangle(t-this.x,e-this.y,this.mesh[this.BL],this.mesh[this.TR],this.mesh[this.BR]))}},{key:"calculateMesh",value:function(){var t=[0,0,this.w,0,this.w,this.h,0,this.h],e=[this.mesh[this.TL].x,this.mesh[this.TL].y,this.mesh[this.TR].x,this.mesh[this.TR].y,this.mesh[this.BR].x,this.mesh[this.BR].y,this.mesh[this.BL].x,this.mesh[this.BL].y];this.perspT=s(t,e);for(var r=this.w/(this.res-1),n=this.h/(this.res-1),o=0;o<this.mesh.length;o++)if(this.TL!=o&&this.BR!=o&&this.TR!=o&&this.BL!=o){var i=o%this.res,u=Math.floor(o/this.res);i*=r,u*=n;var h=this.perspT.transform(i,u);this.mesh[o].x=h[0],this.mesh[o].y=h[1]}}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.surface,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.w,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.h;push(),translate(this.x,this.y),stroke(255,0,255),strokeWeight(3),fill(0,255,0),texture(t),beginShape(TRIANGLES);for(var i=0;i<this.res-1;i++)for(var s=0;s<this.res-1;s++)this.getQuadTriangles(i,s,e,r,n,o);endShape(CLOSE),this.renderControlPoints(),pop()}},{key:"getQuadTriangles",value:function(t,e,r,n,o,i){var s=this.mesh[t+e*this.res];this.getVertexUV(s,r,n,o,i),s=this.mesh[t+1+e*this.res],this.getVertexUV(s,r,n,o,i),s=this.mesh[t+1+(e+1)*this.res],this.getVertexUV(s,r,n,o,i),this.getVertexUV(s,r,n,o,i),s=this.mesh[t+(e+1)*this.res],this.getVertexUV(s,r,n,o,i),s=this.mesh[t+e*this.res],this.getVertexUV(s,r,n,o,i)}},{key:"getVertexUV",value:function(t,e,r,n,o){var i=map(t.u,0,1,e,e+n),s=map(t.v,0,1,r,r+o);vertex(t.x,t.y,i,s)}}],r&&v(e.prototype,r),u}(l);const b=g;function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function w(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function x(t,e,r){return x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=S(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}},x(t,e,r||t)}function P(t,e){return P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},P(t,e)}function T(t,e){if(e&&("object"===k(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function S(t){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},S(t)}var C=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(s,t);var e,r,n,o,i=(n=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=S(n);if(o){var r=S(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return T(this,t)});function s(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(n=i.call(this,t,e,r,"TRI")).setTriMesh(),n}return e=s,r=[{key:"load",value:function(t,e,r){x(S(s.prototype),"load",this).call(this,t,e,r),this.setTriMesh()}},{key:"setTriMesh",value:function(){this.TP=Math.floor(this.res/2)-1,this.mesh[this.TP].setControlPoint(!0),this.mesh[this.TL].setControlPoint(!1),this.mesh[this.TR].setControlPoint(!1)}},{key:"isMouseOver",value:function(){var t=mouseX-width/2,e=mouseY-height/2;return!!this.isPointInTriangle(t-this.x,e-this.y,this.mesh[this.TP],this.mesh[this.BL],this.mesh[this.BR])}},{key:"Barycentric",value:function(t,e,r,n,o,i,s){var u=r.sub(e),h=n.sub(e),a=t.sub(e);u.dot(u),u.dot(h),h.dot(h),a.dot(u),a.dot(h)}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.surface;push(),translate(this.x,this.y),noStroke(),fill(0),texture(t),beginShape();var e=0,r=this.h;vertex(this.mesh[this.BL].x,this.mesh[this.BL].y,e,r),e=this.w/2,r=0,vertex(this.mesh[this.TP].x,this.mesh[this.TP].y,e,r),e=this.w,r=this.h,vertex(this.mesh[this.BR].x,this.mesh[this.BR].y,e,r),endShape(CLOSE),this.renderControlPoints(),pop()}},{key:"getP1",value:function(){return createVector(this.mesh[this.TP].x,mesh[this.TP].y)}},{key:"getP2",value:function(){return createVector(this.mesh[this.BL].x,mesh[this.BL].y)}},{key:"getP3",value:function(){return createVector(this.mesh[this.BR].x,mesh[this.BR].y)}}],r&&w(e.prototype,r),s}(l);const O=C;function j(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return R(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?R(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,i=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw i}}}}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var B=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.surfaces=[],this.dragged=null,this.calibrate=!1}var e,r;return e=t,(r=[{key:"createQuad",value:function(t,e,r){var n=new b(t,e,r);return this.surfaces.push(n),n}},{key:"createTri",value:function(t,e,r){var n=new O(t,e,r);return this.surfaces.push(n),n}},{key:"renderSurfaces",value:function(){var t,e=j(this.surfaces);try{for(e.s();!(t=e.n()).done;)t.value.render()}catch(t){e.e(t)}finally{e.f()}}},{key:"getSurface",value:function(t){return this.surfaces[t]}},{key:"getSurfaceCount",value:function(){return this.surfaces.length}},{key:"clearSurfaces",value:function(){this.surfaces=[]}},{key:"onClick",value:function(){if(this.calibrate)for(var t=this.surfaces.length-1;t>=0;t--){var e=this.surfaces[t];if(this.dragged=e.select(),null!=this.dragged)break}}},{key:"onDrag",value:function(){var t=mouseX-width/2,e=mouseY-height/2;null!=this.dragged&&this.dragged.moveTo(t,e)}},{key:"onRelease",value:function(){this.dragged=null}},{key:"load",value:function(){var t=this;loadJSON("map.json",(function(e){return t.setSurfaces}))}},{key:"setSurfaces",value:function(t){if(t.surfaces){var e,r=j(t.surfaces);try{for(r.s();!(e=r.n()).done;){var n=e.value;if("QUAD"===n.type){var o=this.createQuad(n.w,n.h,n.res),i=n.points,s=n.x,u=n.y;o.load(s,u,i)}else if("TRI"===n.type){var h=this.createTri(n.w,n.h,n.res),a=n.points,f=n.x,c=n.y;h.load(f,c,a)}}}catch(t){r.e(t)}finally{r.f()}}else console.log("no surfaces to load; is map.json corrupt?")}},{key:"save",value:function(){var t,e={surfaces:[]},r=j(this.surfaces);try{for(r.s();!(t=r.n()).done;){var n=t.value,o={};o.res=n.getRes(),o.x=n.x,o.y=n.y,o.w=n.w,o.h=n.h,o.type=n.type,o.points=[];for(var i=0;i<n.mesh.length;i++)if(n.mesh[i].isControlPoint()){var s={};s.i=i,s.x=n.mesh[i].x,s.y=n.mesh[i].y,s.u=n.mesh[i].u,s.v=n.mesh[i].v,o.points.push(s)}e.surfaces.push(o)}}catch(t){r.e(t)}finally{r.f()}saveJSON(e,"map.json"),console.log("mapping saved to map.json")}},{key:"startCalibration",value:function(){this.calibrate=!0}},{key:"stopCalibration",value:function(){this.calibrate=!1}},{key:"toggleCalibration",value:function(){this.calibrate=!this.calibrate}}])&&M(e.prototype,r),t}());return p5.prototype.getP5Mapper=function(){return B},p5.prototype.renderSurfaces=function(){B.renderSurfaces()},p5.prototype.registerMethod("post",p5.prototype.renderSurfaces),t})()}));